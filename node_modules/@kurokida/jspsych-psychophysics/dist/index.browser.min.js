var Mi=Object.defineProperty;var we=_=>{throw TypeError(_)},Nt=Math.pow,Si=(_,W,et)=>W in _?Mi(_,W,{enumerable:!0,configurable:!0,writable:!0,value:et}):_[W]=et;var ye=(_,W,et)=>Si(_,typeof W!="symbol"?W+"":W,et),Qt=(_,W,et)=>W.has(_)||we("Cannot "+et);var _t=(_,W,et)=>(Qt(_,W,"read from private field"),et?et.call(_):W.get(_)),At=(_,W,et)=>W.has(_)?we("Cannot add the same private member more than once"):W instanceof WeakSet?W.add(_):W.set(_,et),Vt=(_,W,et,A)=>(Qt(_,W,"write to private field"),A?A.call(_,et):W.set(_,et),et),Zt=(_,W,et)=>(Qt(_,W,"access private method"),et);if(typeof PIXI=="undefined")var PIXI;var jsPsychPsychophysics=function(_,W){"use strict";var Ct,Ht,St,lt;function et(n){var s=Object.create(null);return n&&Object.keys(n).forEach(function(e){if(e!=="default"){var t=Object.getOwnPropertyDescriptor(n,e);Object.defineProperty(s,e,t.get?t:{enumerable:!0,get:function(){return n[e]}})}}),s.default=n,Object.freeze(s)}var A=et(W);function te(n){if(n.__esModule)return n;var s=n.default;if(typeof s=="function"){var e=function t(){return this instanceof t?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};e.prototype=s.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(t){var i=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:function(){return n[t]}})}),e}var z={};const _e=Object.prototype.toString;function Rt(n){const s=_e.call(n);return s.endsWith("Array]")&&!s.includes("Big")}var be=Object.freeze({__proto__:null,isAnyArray:Rt}),ve=te(be);function Te(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Rt(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var e=s.fromIndex,t=e===void 0?0:e,i=s.toIndex,o=i===void 0?n.length:i;if(t<0||t>=n.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=t||o>n.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var r=n[t],l=t+1;l<o;l++)n[l]>r&&(r=n[l]);return r}function Me(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Rt(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var e=s.fromIndex,t=e===void 0?0:e,i=s.toIndex,o=i===void 0?n.length:i;if(t<0||t>=n.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=t||o>n.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var r=n[t],l=t+1;l<o;l++)n[l]<r&&(r=n[l]);return r}function Se(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Rt(n)){if(n.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var e;if(s.output!==void 0){if(!Rt(s.output))throw new TypeError("output option must be an array if specified");e=s.output}else e=new Array(n.length);var t=Me(n),i=Te(n);if(t===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var o=s.min,r=o===void 0?s.autoMinMax?t:0:o,l=s.max,h=l===void 0?s.autoMinMax?i:1:l;if(r>=h)throw new RangeError("min option must be smaller than max option");for(var u=(h-r)/(i-t),m=0;m<n.length;m++)e[m]=(n[m]-t)*u+r;return e}var je=Object.freeze({__proto__:null,default:Se}),xe=te(je);Object.defineProperty(z,"__esModule",{value:!0});var ut=ve,ee=xe;const Yt=" ".repeat(2),ie=" ".repeat(4);function ke(){return se(this)}function se(n,s={}){const{maxRows:e=15,maxColumns:t=10,maxNumSize:i=8,padMinus:o="auto"}=s;return`${n.constructor.name} {
${Yt}[
${ie}${Ee(n,e,t,i,o)}
${Yt}]
${Yt}rows: ${n.rows}
${Yt}columns: ${n.columns}
}`}function Ee(n,s,e,t,i){const{rows:o,columns:r}=n,l=Math.min(o,s),h=Math.min(r,e),u=[];if(i==="auto"){i=!1;t:for(let m=0;m<l;m++)for(let a=0;a<h;a++)if(n.get(m,a)<0){i=!0;break t}}for(let m=0;m<l;m++){let a=[];for(let d=0;d<h;d++)a.push(Pe(n.get(m,d),t,i));u.push(`${a.join(" ")}`)}return h!==r&&(u[u.length-1]+=` ... ${r-e} more columns`),l!==o&&u.push(`... ${o-s} more rows`),u.join(`
${ie}`)}function Pe(n,s,e){return(n>=0&&e?` ${oe(n,s-1)}`:oe(n,s)).padEnd(s)}function oe(n,s){let e=n.toString();if(e.length<=s)return e;let t=n.toFixed(s);if(t.length>s&&(t=n.toFixed(Math.max(0,s-(t.length-s)))),t.length<=s&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let i=n.toExponential(s);return i.length>s&&(i=n.toExponential(Math.max(0,s-(i.length-s)))),i.slice(0)}function Ie(n,s){n.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},n.prototype.addS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)+t);return this},n.prototype.addM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)+t.get(i,o));return this},n.add=function(t,i){return new s(t).add(i)},n.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},n.prototype.subS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)-t);return this},n.prototype.subM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)-t.get(i,o));return this},n.sub=function(t,i){return new s(t).sub(i)},n.prototype.subtract=n.prototype.sub,n.prototype.subtractS=n.prototype.subS,n.prototype.subtractM=n.prototype.subM,n.subtract=n.sub,n.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},n.prototype.mulS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)*t);return this},n.prototype.mulM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)*t.get(i,o));return this},n.mul=function(t,i){return new s(t).mul(i)},n.prototype.multiply=n.prototype.mul,n.prototype.multiplyS=n.prototype.mulS,n.prototype.multiplyM=n.prototype.mulM,n.multiply=n.mul,n.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},n.prototype.divS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)/t);return this},n.prototype.divM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)/t.get(i,o));return this},n.div=function(t,i){return new s(t).div(i)},n.prototype.divide=n.prototype.div,n.prototype.divideS=n.prototype.divS,n.prototype.divideM=n.prototype.divM,n.divide=n.div,n.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},n.prototype.modS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)%t);return this},n.prototype.modM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)%t.get(i,o));return this},n.mod=function(t,i){return new s(t).mod(i)},n.prototype.modulus=n.prototype.mod,n.prototype.modulusS=n.prototype.modS,n.prototype.modulusM=n.prototype.modM,n.modulus=n.mod,n.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},n.prototype.andS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)&t);return this},n.prototype.andM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)&t.get(i,o));return this},n.and=function(t,i){return new s(t).and(i)},n.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},n.prototype.orS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)|t);return this},n.prototype.orM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)|t.get(i,o));return this},n.or=function(t,i){return new s(t).or(i)},n.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},n.prototype.xorS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)^t);return this},n.prototype.xorM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)^t.get(i,o));return this},n.xor=function(t,i){return new s(t).xor(i)},n.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},n.prototype.leftShiftS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)<<t);return this},n.prototype.leftShiftM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)<<t.get(i,o));return this},n.leftShift=function(t,i){return new s(t).leftShift(i)},n.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},n.prototype.signPropagatingRightShiftS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)>>t);return this},n.prototype.signPropagatingRightShiftM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)>>t.get(i,o));return this},n.signPropagatingRightShift=function(t,i){return new s(t).signPropagatingRightShift(i)},n.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},n.prototype.rightShiftS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)>>>t);return this},n.prototype.rightShiftM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)>>>t.get(i,o));return this},n.rightShift=function(t,i){return new s(t).rightShift(i)},n.prototype.zeroFillRightShift=n.prototype.rightShift,n.prototype.zeroFillRightShiftS=n.prototype.rightShiftS,n.prototype.zeroFillRightShiftM=n.prototype.rightShiftM,n.zeroFillRightShift=n.rightShift,n.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,~this.get(t,i));return this},n.not=function(t){return new s(t).not()},n.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.abs(this.get(t,i)));return this},n.abs=function(t){return new s(t).abs()},n.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.acos(this.get(t,i)));return this},n.acos=function(t){return new s(t).acos()},n.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.acosh(this.get(t,i)));return this},n.acosh=function(t){return new s(t).acosh()},n.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.asin(this.get(t,i)));return this},n.asin=function(t){return new s(t).asin()},n.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.asinh(this.get(t,i)));return this},n.asinh=function(t){return new s(t).asinh()},n.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.atan(this.get(t,i)));return this},n.atan=function(t){return new s(t).atan()},n.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.atanh(this.get(t,i)));return this},n.atanh=function(t){return new s(t).atanh()},n.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.cbrt(this.get(t,i)));return this},n.cbrt=function(t){return new s(t).cbrt()},n.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.ceil(this.get(t,i)));return this},n.ceil=function(t){return new s(t).ceil()},n.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.clz32(this.get(t,i)));return this},n.clz32=function(t){return new s(t).clz32()},n.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.cos(this.get(t,i)));return this},n.cos=function(t){return new s(t).cos()},n.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.cosh(this.get(t,i)));return this},n.cosh=function(t){return new s(t).cosh()},n.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.exp(this.get(t,i)));return this},n.exp=function(t){return new s(t).exp()},n.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.expm1(this.get(t,i)));return this},n.expm1=function(t){return new s(t).expm1()},n.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.floor(this.get(t,i)));return this},n.floor=function(t){return new s(t).floor()},n.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.fround(this.get(t,i)));return this},n.fround=function(t){return new s(t).fround()},n.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.log(this.get(t,i)));return this},n.log=function(t){return new s(t).log()},n.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.log1p(this.get(t,i)));return this},n.log1p=function(t){return new s(t).log1p()},n.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.log10(this.get(t,i)));return this},n.log10=function(t){return new s(t).log10()},n.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.log2(this.get(t,i)));return this},n.log2=function(t){return new s(t).log2()},n.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.round(this.get(t,i)));return this},n.round=function(t){return new s(t).round()},n.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.sign(this.get(t,i)));return this},n.sign=function(t){return new s(t).sign()},n.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.sin(this.get(t,i)));return this},n.sin=function(t){return new s(t).sin()},n.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.sinh(this.get(t,i)));return this},n.sinh=function(t){return new s(t).sinh()},n.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.sqrt(this.get(t,i)));return this},n.sqrt=function(t){return new s(t).sqrt()},n.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.tan(this.get(t,i)));return this},n.tan=function(t){return new s(t).tan()},n.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.tanh(this.get(t,i)));return this},n.tanh=function(t){return new s(t).tanh()},n.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.trunc(this.get(t,i)));return this},n.trunc=function(t){return new s(t).trunc()},n.pow=function(t,i){return new s(t).pow(i)},n.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},n.prototype.powS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,Nt(this.get(i,o),t));return this},n.prototype.powM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,Nt(this.get(i,o),t.get(i,o)));return this}}function dt(n,s,e){let t=e?n.rows:n.rows-1;if(s<0||s>t)throw new RangeError("Row index out of range")}function gt(n,s,e){let t=e?n.columns:n.columns-1;if(s<0||s>t)throw new RangeError("Column index out of range")}function kt(n,s){if(s.to1DArray&&(s=s.to1DArray()),s.length!==n.columns)throw new RangeError("vector size must be the same as the number of columns");return s}function Et(n,s){if(s.to1DArray&&(s=s.to1DArray()),s.length!==n.rows)throw new RangeError("vector size must be the same as the number of rows");return s}function Ut(n,s){if(!ut.isAnyArray(s))throw new TypeError("row indices must be an array");for(let e=0;e<s.length;e++)if(s[e]<0||s[e]>=n.rows)throw new RangeError("row indices are out of range")}function Wt(n,s){if(!ut.isAnyArray(s))throw new TypeError("column indices must be an array");for(let e=0;e<s.length;e++)if(s[e]<0||s[e]>=n.columns)throw new RangeError("column indices are out of range")}function Jt(n,s,e,t,i){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(Ot("startRow",s),Ot("endRow",e),Ot("startColumn",t),Ot("endColumn",i),s>e||t>i||s<0||s>=n.rows||e<0||e>=n.rows||t<0||t>=n.columns||i<0||i>=n.columns)throw new RangeError("Submatrix indices are out of range")}function Ft(n,s=0){let e=[];for(let t=0;t<n;t++)e.push(s);return e}function Ot(n,s){if(typeof s!="number")throw new TypeError(`${n} must be a number`)}function Pt(n){if(n.isEmpty())throw new Error("Empty matrix has no elements to index")}function Ne(n){let s=Ft(n.rows);for(let e=0;e<n.rows;++e)for(let t=0;t<n.columns;++t)s[e]+=n.get(e,t);return s}function Re(n){let s=Ft(n.columns);for(let e=0;e<n.rows;++e)for(let t=0;t<n.columns;++t)s[t]+=n.get(e,t);return s}function Ce(n){let s=0;for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)s+=n.get(e,t);return s}function Le(n){let s=Ft(n.rows,1);for(let e=0;e<n.rows;++e)for(let t=0;t<n.columns;++t)s[e]*=n.get(e,t);return s}function Ye(n){let s=Ft(n.columns,1);for(let e=0;e<n.rows;++e)for(let t=0;t<n.columns;++t)s[t]*=n.get(e,t);return s}function Fe(n){let s=1;for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)s*=n.get(e,t);return s}function Oe(n,s,e){const t=n.rows,i=n.columns,o=[];for(let r=0;r<t;r++){let l=0,h=0,u=0;for(let m=0;m<i;m++)u=n.get(r,m)-e[r],l+=u,h+=u*u;s?o.push((h-l*l/i)/(i-1)):o.push((h-l*l/i)/i)}return o}function qe(n,s,e){const t=n.rows,i=n.columns,o=[];for(let r=0;r<i;r++){let l=0,h=0,u=0;for(let m=0;m<t;m++)u=n.get(m,r)-e[r],l+=u,h+=u*u;s?o.push((h-l*l/t)/(t-1)):o.push((h-l*l/t)/t)}return o}function Xe(n,s,e){const t=n.rows,i=n.columns,o=t*i;let r=0,l=0,h=0;for(let u=0;u<t;u++)for(let m=0;m<i;m++)h=n.get(u,m)-e,r+=h,l+=h*h;return s?(l-r*r/o)/(o-1):(l-r*r/o)/o}function De(n,s){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)-s[e])}function ze(n,s){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)-s[t])}function Be(n,s){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)-s)}function $e(n){const s=[];for(let e=0;e<n.rows;e++){let t=0;for(let i=0;i<n.columns;i++)t+=Nt(n.get(e,i),2)/(n.columns-1);s.push(Math.sqrt(t))}return s}function Ge(n,s){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)/s[e])}function Ve(n){const s=[];for(let e=0;e<n.columns;e++){let t=0;for(let i=0;i<n.rows;i++)t+=Nt(n.get(i,e),2)/(n.rows-1);s.push(Math.sqrt(t))}return s}function Ue(n,s){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)/s[t])}function We(n){const s=n.size-1;let e=0;for(let t=0;t<n.columns;t++)for(let i=0;i<n.rows;i++)e+=Nt(n.get(i,t),2)/s;return Math.sqrt(e)}function Je(n,s){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)/s)}class X{static from1DArray(s,e,t){if(s*e!==t.length)throw new RangeError("data length does not match given dimensions");let o=new x(s,e);for(let r=0;r<s;r++)for(let l=0;l<e;l++)o.set(r,l,t[r*e+l]);return o}static rowVector(s){let e=new x(1,s.length);for(let t=0;t<s.length;t++)e.set(0,t,s[t]);return e}static columnVector(s){let e=new x(s.length,1);for(let t=0;t<s.length;t++)e.set(t,0,s[t]);return e}static zeros(s,e){return new x(s,e)}static ones(s,e){return new x(s,e).fill(1)}static rand(s,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:i=Math.random}=t;let o=new x(s,e);for(let r=0;r<s;r++)for(let l=0;l<e;l++)o.set(r,l,i());return o}static randInt(s,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:i=0,max:o=1e3,random:r=Math.random}=t;if(!Number.isInteger(i))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(i>=o)throw new RangeError("min must be smaller than max");let l=o-i,h=new x(s,e);for(let u=0;u<s;u++)for(let m=0;m<e;m++){let a=i+Math.round(r()*l);h.set(u,m,a)}return h}static eye(s,e,t){e===void 0&&(e=s),t===void 0&&(t=1);let i=Math.min(s,e),o=this.zeros(s,e);for(let r=0;r<i;r++)o.set(r,r,t);return o}static diag(s,e,t){let i=s.length;e===void 0&&(e=i),t===void 0&&(t=e);let o=Math.min(i,e,t),r=this.zeros(e,t);for(let l=0;l<o;l++)r.set(l,l,s[l]);return r}static min(s,e){s=this.checkMatrix(s),e=this.checkMatrix(e);let t=s.rows,i=s.columns,o=new x(t,i);for(let r=0;r<t;r++)for(let l=0;l<i;l++)o.set(r,l,Math.min(s.get(r,l),e.get(r,l)));return o}static max(s,e){s=this.checkMatrix(s),e=this.checkMatrix(e);let t=s.rows,i=s.columns,o=new this(t,i);for(let r=0;r<t;r++)for(let l=0;l<i;l++)o.set(r,l,Math.max(s.get(r,l),e.get(r,l)));return o}static checkMatrix(s){return X.isMatrix(s)?s:new x(s)}static isMatrix(s){return s!=null&&s.klass==="Matrix"}get size(){return this.rows*this.columns}apply(s){if(typeof s!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)s.call(this,e,t);return this}to1DArray(){let s=[];for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)s.push(this.get(e,t));return s}to2DArray(){let s=[];for(let e=0;e<this.rows;e++){s.push([]);for(let t=0;t<this.columns;t++)s[e].push(this.get(e,t))}return s}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let s=0;s<this.rows;s++)for(let e=0;e<=s;e++)if(this.get(s,e)!==this.get(e,s))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let s=0;s<this.rows;s++)if(this.get(s,s)!==0)return!1;return!0}isEchelonForm(){let s=0,e=0,t=-1,i=!0,o=!1;for(;s<this.rows&&i;){for(e=0,o=!1;e<this.columns&&o===!1;)this.get(s,e)===0?e++:this.get(s,e)===1&&e>t?(o=!0,t=e):(i=!1,o=!0);s++}return i}isReducedEchelonForm(){let s=0,e=0,t=-1,i=!0,o=!1;for(;s<this.rows&&i;){for(e=0,o=!1;e<this.columns&&o===!1;)this.get(s,e)===0?e++:this.get(s,e)===1&&e>t?(o=!0,t=e):(i=!1,o=!0);for(let r=e+1;r<this.rows;r++)this.get(s,r)!==0&&(i=!1);s++}return i}echelonForm(){let s=this.clone(),e=0,t=0;for(;e<s.rows&&t<s.columns;){let i=e;for(let o=e;o<s.rows;o++)s.get(o,t)>s.get(i,t)&&(i=o);if(s.get(i,t)===0)t++;else{s.swapRows(e,i);let o=s.get(e,t);for(let r=t;r<s.columns;r++)s.set(e,r,s.get(e,r)/o);for(let r=e+1;r<s.rows;r++){let l=s.get(r,t)/s.get(e,t);s.set(r,t,0);for(let h=t+1;h<s.columns;h++)s.set(r,h,s.get(r,h)-s.get(e,h)*l)}e++,t++}}return s}reducedEchelonForm(){let s=this.echelonForm(),e=s.columns,t=s.rows,i=t-1;for(;i>=0;)if(s.maxRow(i)===0)i--;else{let o=0,r=!1;for(;o<t&&r===!1;)s.get(i,o)===1?r=!0:o++;for(let l=0;l<i;l++){let h=s.get(l,o);for(let u=o;u<e;u++){let m=s.get(l,u)-h*s.get(i,u);s.set(l,u,m)}}i--}return s}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(s={}){if(typeof s!="object")throw new TypeError("options must be an object");const{rows:e=1,columns:t=1}=s;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let i=new x(this.rows*e,this.columns*t);for(let o=0;o<e;o++)for(let r=0;r<t;r++)i.setSubMatrix(this,this.rows*o,this.columns*r);return i}fill(s){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,s);return this}neg(){return this.mulS(-1)}getRow(s){dt(this,s);let e=[];for(let t=0;t<this.columns;t++)e.push(this.get(s,t));return e}getRowVector(s){return x.rowVector(this.getRow(s))}setRow(s,e){dt(this,s),e=kt(this,e);for(let t=0;t<this.columns;t++)this.set(s,t,e[t]);return this}swapRows(s,e){dt(this,s),dt(this,e);for(let t=0;t<this.columns;t++){let i=this.get(s,t);this.set(s,t,this.get(e,t)),this.set(e,t,i)}return this}getColumn(s){gt(this,s);let e=[];for(let t=0;t<this.rows;t++)e.push(this.get(t,s));return e}getColumnVector(s){return x.columnVector(this.getColumn(s))}setColumn(s,e){gt(this,s),e=Et(this,e);for(let t=0;t<this.rows;t++)this.set(t,s,e[t]);return this}swapColumns(s,e){gt(this,s),gt(this,e);for(let t=0;t<this.rows;t++){let i=this.get(t,s);this.set(t,s,this.get(t,e)),this.set(t,e,i)}return this}addRowVector(s){s=kt(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+s[t]);return this}subRowVector(s){s=kt(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-s[t]);return this}mulRowVector(s){s=kt(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*s[t]);return this}divRowVector(s){s=kt(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/s[t]);return this}addColumnVector(s){s=Et(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+s[e]);return this}subColumnVector(s){s=Et(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-s[e]);return this}mulColumnVector(s){s=Et(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*s[e]);return this}divColumnVector(s){s=Et(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/s[e]);return this}mulRow(s,e){dt(this,s);for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)*e);return this}mulColumn(s,e){gt(this,s);for(let t=0;t<this.rows;t++)this.set(t,s,this.get(t,s)*e);return this}max(s){if(this.isEmpty())return NaN;switch(s){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)>e[t]&&(e[t]=this.get(t,i));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)>e[i]&&(e[i]=this.get(t,i));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)>e&&(e=this.get(t,i));return e}default:throw new Error(`invalid option: ${s}`)}}maxIndex(){Pt(this);let s=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)>s&&(s=this.get(t,i),e[0]=t,e[1]=i);return e}min(s){if(this.isEmpty())return NaN;switch(s){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)<e[t]&&(e[t]=this.get(t,i));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)<e[i]&&(e[i]=this.get(t,i));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)<e&&(e=this.get(t,i));return e}default:throw new Error(`invalid option: ${s}`)}}minIndex(){Pt(this);let s=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)<s&&(s=this.get(t,i),e[0]=t,e[1]=i);return e}maxRow(s){if(dt(this,s),this.isEmpty())return NaN;let e=this.get(s,0);for(let t=1;t<this.columns;t++)this.get(s,t)>e&&(e=this.get(s,t));return e}maxRowIndex(s){dt(this,s),Pt(this);let e=this.get(s,0),t=[s,0];for(let i=1;i<this.columns;i++)this.get(s,i)>e&&(e=this.get(s,i),t[1]=i);return t}minRow(s){if(dt(this,s),this.isEmpty())return NaN;let e=this.get(s,0);for(let t=1;t<this.columns;t++)this.get(s,t)<e&&(e=this.get(s,t));return e}minRowIndex(s){dt(this,s),Pt(this);let e=this.get(s,0),t=[s,0];for(let i=1;i<this.columns;i++)this.get(s,i)<e&&(e=this.get(s,i),t[1]=i);return t}maxColumn(s){if(gt(this,s),this.isEmpty())return NaN;let e=this.get(0,s);for(let t=1;t<this.rows;t++)this.get(t,s)>e&&(e=this.get(t,s));return e}maxColumnIndex(s){gt(this,s),Pt(this);let e=this.get(0,s),t=[0,s];for(let i=1;i<this.rows;i++)this.get(i,s)>e&&(e=this.get(i,s),t[0]=i);return t}minColumn(s){if(gt(this,s),this.isEmpty())return NaN;let e=this.get(0,s);for(let t=1;t<this.rows;t++)this.get(t,s)<e&&(e=this.get(t,s));return e}minColumnIndex(s){gt(this,s),Pt(this);let e=this.get(0,s),t=[0,s];for(let i=1;i<this.rows;i++)this.get(i,s)<e&&(e=this.get(i,s),t[0]=i);return t}diag(){let s=Math.min(this.rows,this.columns),e=[];for(let t=0;t<s;t++)e.push(this.get(t,t));return e}norm(s="frobenius"){switch(s){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${s}`)}}cumulativeSum(){let s=0;for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)s+=this.get(e,t),this.set(e,t,s);return this}dot(s){X.isMatrix(s)&&(s=s.to1DArray());let e=this.to1DArray();if(e.length!==s.length)throw new RangeError("vectors do not have the same size");let t=0;for(let i=0;i<e.length;i++)t+=e[i]*s[i];return t}mmul(s){s=x.checkMatrix(s);let e=this.rows,t=this.columns,i=s.columns,o=new x(e,i),r=new Float64Array(t);for(let l=0;l<i;l++){for(let h=0;h<t;h++)r[h]=s.get(h,l);for(let h=0;h<e;h++){let u=0;for(let m=0;m<t;m++)u+=this.get(h,m)*r[m];o.set(h,l,u)}}return o}mpow(s){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(s)||s<0)throw new RangeError("Exponent must be a non-negative integer");let e=x.eye(this.rows),t=this;for(let i=s;i>1;i/=2)i&1&&(e=e.mmul(t)),t=t.mmul(t);return e}strassen2x2(s){s=x.checkMatrix(s);let e=new x(2,2);const t=this.get(0,0),i=s.get(0,0),o=this.get(0,1),r=s.get(0,1),l=this.get(1,0),h=s.get(1,0),u=this.get(1,1),m=s.get(1,1),a=(t+u)*(i+m),d=(l+u)*i,M=t*(r-m),p=u*(h-i),g=(t+o)*m,P=(l-t)*(i+r),f=(o-u)*(h+m),T=a+p-g+f,I=M+g,Y=d+p,F=a-d+M+P;return e.set(0,0,T),e.set(0,1,I),e.set(1,0,Y),e.set(1,1,F),e}strassen3x3(s){s=x.checkMatrix(s);let e=new x(3,3);const t=this.get(0,0),i=this.get(0,1),o=this.get(0,2),r=this.get(1,0),l=this.get(1,1),h=this.get(1,2),u=this.get(2,0),m=this.get(2,1),a=this.get(2,2),d=s.get(0,0),M=s.get(0,1),p=s.get(0,2),g=s.get(1,0),P=s.get(1,1),f=s.get(1,2),T=s.get(2,0),I=s.get(2,1),Y=s.get(2,2),F=(t+i+o-r-l-m-a)*P,V=(t-r)*(-M+P),E=l*(-d+M+g-P-f-T+Y),C=(-t+r+l)*(d-M+P),$=(r+l)*(-d+M),c=t*d,y=(-t+u+m)*(d-p+f),k=(-t+u)*(p-f),v=(u+m)*(-d+p),O=(t+i+o-l-h-u-m)*f,D=m*(-d+p+g-P-f-T+I),B=(-o+m+a)*(P+T-I),S=(o-a)*(P-I),H=o*T,ct=(m+a)*(-T+I),Z=(-o+l+h)*(f+T-Y),at=(o-h)*(f-Y),nt=(l+h)*(-T+Y),q=i*g,tt=h*I,it=r*p,st=u*M,J=a*Y,wt=c+H+q,jt=F+C+$+c+B+H+ct,Lt=c+y+v+O+H+Z+nt,N=V+E+C+c+H+Z+at,b=V+C+$+c+tt,w=H+Z+at+nt+it,R=c+y+k+D+B+S+H,L=B+S+H+ct+st,j=c+y+k+v+J;return e.set(0,0,wt),e.set(0,1,jt),e.set(0,2,Lt),e.set(1,0,N),e.set(1,1,b),e.set(1,2,w),e.set(2,0,R),e.set(2,1,L),e.set(2,2,j),e}mmulStrassen(s){s=x.checkMatrix(s);let e=this.clone(),t=e.rows,i=e.columns,o=s.rows,r=s.columns;i!==o&&console.warn(`Multiplying ${t} x ${i} and ${o} x ${r} matrix: dimensions do not match.`);function l(a,d,M){let p=a.rows,g=a.columns;if(p===d&&g===M)return a;{let P=X.zeros(d,M);return P=P.setSubMatrix(a,0,0),P}}let h=Math.max(t,o),u=Math.max(i,r);e=l(e,h,u),s=l(s,h,u);function m(a,d,M,p){if(M<=512||p<=512)return a.mmul(d);M%2===1&&p%2===1?(a=l(a,M+1,p+1),d=l(d,M+1,p+1)):M%2===1?(a=l(a,M+1,p),d=l(d,M+1,p)):p%2===1&&(a=l(a,M,p+1),d=l(d,M,p+1));let g=parseInt(a.rows/2,10),P=parseInt(a.columns/2,10),f=a.subMatrix(0,g-1,0,P-1),T=d.subMatrix(0,g-1,0,P-1),I=a.subMatrix(0,g-1,P,a.columns-1),Y=d.subMatrix(0,g-1,P,d.columns-1),F=a.subMatrix(g,a.rows-1,0,P-1),V=d.subMatrix(g,d.rows-1,0,P-1),E=a.subMatrix(g,a.rows-1,P,a.columns-1),C=d.subMatrix(g,d.rows-1,P,d.columns-1),$=m(X.add(f,E),X.add(T,C),g,P),c=m(X.add(F,E),T,g,P),y=m(f,X.sub(Y,C),g,P),k=m(E,X.sub(V,T),g,P),v=m(X.add(f,I),C,g,P),O=m(X.sub(F,f),X.add(T,Y),g,P),D=m(X.sub(I,E),X.add(V,C),g,P),B=X.add($,k);B.sub(v),B.add(D);let S=X.add(y,v),H=X.add(c,k),ct=X.sub($,c);ct.add(y),ct.add(O);let Z=X.zeros(2*B.rows,2*B.columns);return Z=Z.setSubMatrix(B,0,0),Z=Z.setSubMatrix(S,B.rows,0),Z=Z.setSubMatrix(H,0,B.columns),Z=Z.setSubMatrix(ct,B.rows,B.columns),Z.subMatrix(0,M-1,0,p-1)}return m(e,s,h,u)}scaleRows(s={}){if(typeof s!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=s;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let i=new x(this.rows,this.columns);for(let o=0;o<this.rows;o++){const r=this.getRow(o);r.length>0&&ee(r,{min:e,max:t,output:r}),i.setRow(o,r)}return i}scaleColumns(s={}){if(typeof s!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=s;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let i=new x(this.rows,this.columns);for(let o=0;o<this.columns;o++){const r=this.getColumn(o);r.length&&ee(r,{min:e,max:t,output:r}),i.setColumn(o,r)}return i}flipRows(){const s=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let t=0;t<s;t++){let i=this.get(e,t),o=this.get(e,this.columns-1-t);this.set(e,t,o),this.set(e,this.columns-1-t,i)}return this}flipColumns(){const s=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let t=0;t<s;t++){let i=this.get(t,e),o=this.get(this.rows-1-t,e);this.set(t,e,o),this.set(this.rows-1-t,e,i)}return this}kroneckerProduct(s){s=x.checkMatrix(s);let e=this.rows,t=this.columns,i=s.rows,o=s.columns,r=new x(e*i,t*o);for(let l=0;l<e;l++)for(let h=0;h<t;h++)for(let u=0;u<i;u++)for(let m=0;m<o;m++)r.set(i*l+u,o*h+m,this.get(l,h)*s.get(u,m));return r}kroneckerSum(s){if(s=x.checkMatrix(s),!this.isSquare()||!s.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,t=s.rows,i=this.kroneckerProduct(x.eye(t,t)),o=x.eye(e,e).kroneckerProduct(s);return i.add(o)}transpose(){let s=new x(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)s.set(t,e,this.get(e,t));return s}sortRows(s=ne){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(s));return this}sortColumns(s=ne){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(s));return this}subMatrix(s,e,t,i){Jt(this,s,e,t,i);let o=new x(e-s+1,i-t+1);for(let r=s;r<=e;r++)for(let l=t;l<=i;l++)o.set(r-s,l-t,this.get(r,l));return o}subMatrixRow(s,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.columns-1),e>t||e<0||e>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let i=new x(s.length,t-e+1);for(let o=0;o<s.length;o++)for(let r=e;r<=t;r++){if(s[o]<0||s[o]>=this.rows)throw new RangeError(`Row index out of range: ${s[o]}`);i.set(o,r-e,this.get(s[o],r))}return i}subMatrixColumn(s,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.rows-1),e>t||e<0||e>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let i=new x(t-e+1,s.length);for(let o=0;o<s.length;o++)for(let r=e;r<=t;r++){if(s[o]<0||s[o]>=this.columns)throw new RangeError(`Column index out of range: ${s[o]}`);i.set(r-e,o,this.get(r,s[o]))}return i}setSubMatrix(s,e,t){if(s=x.checkMatrix(s),s.isEmpty())return this;let i=e+s.rows-1,o=t+s.columns-1;Jt(this,e,i,t,o);for(let r=0;r<s.rows;r++)for(let l=0;l<s.columns;l++)this.set(e+r,t+l,s.get(r,l));return this}selection(s,e){Ut(this,s),Wt(this,e);let t=new x(s.length,e.length);for(let i=0;i<s.length;i++){let o=s[i];for(let r=0;r<e.length;r++){let l=e[r];t.set(i,r,this.get(o,l))}}return t}trace(){let s=Math.min(this.rows,this.columns),e=0;for(let t=0;t<s;t++)e+=this.get(t,t);return e}clone(){return this.constructor.copy(this,new x(this.rows,this.columns))}static copy(s,e){for(const[t,i,o]of s.entries())e.set(t,i,o);return e}sum(s){switch(s){case"row":return Ne(this);case"column":return Re(this);case void 0:return Ce(this);default:throw new Error(`invalid option: ${s}`)}}product(s){switch(s){case"row":return Le(this);case"column":return Ye(this);case void 0:return Fe(this);default:throw new Error(`invalid option: ${s}`)}}mean(s){const e=this.sum(s);switch(s){case"row":{for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e}case"column":{for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${s}`)}}variance(s,e={}){if(typeof s=="object"&&(e=s,s=void 0),typeof e!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:i=this.mean(s)}=e;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(s){case"row":{if(!ut.isAnyArray(i))throw new TypeError("mean must be an array");return Oe(this,t,i)}case"column":{if(!ut.isAnyArray(i))throw new TypeError("mean must be an array");return qe(this,t,i)}case void 0:{if(typeof i!="number")throw new TypeError("mean must be a number");return Xe(this,t,i)}default:throw new Error(`invalid option: ${s}`)}}standardDeviation(s,e){typeof s=="object"&&(e=s,s=void 0);const t=this.variance(s,e);if(s===void 0)return Math.sqrt(t);for(let i=0;i<t.length;i++)t[i]=Math.sqrt(t[i]);return t}center(s,e={}){if(typeof s=="object"&&(e=s,s=void 0),typeof e!="object")throw new TypeError("options must be an object");const{center:t=this.mean(s)}=e;switch(s){case"row":{if(!ut.isAnyArray(t))throw new TypeError("center must be an array");return De(this,t),this}case"column":{if(!ut.isAnyArray(t))throw new TypeError("center must be an array");return ze(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return Be(this,t),this}default:throw new Error(`invalid option: ${s}`)}}scale(s,e={}){if(typeof s=="object"&&(e=s,s=void 0),typeof e!="object")throw new TypeError("options must be an object");let t=e.scale;switch(s){case"row":{if(t===void 0)t=$e(this);else if(!ut.isAnyArray(t))throw new TypeError("scale must be an array");return Ge(this,t),this}case"column":{if(t===void 0)t=Ve(this);else if(!ut.isAnyArray(t))throw new TypeError("scale must be an array");return Ue(this,t),this}case void 0:{if(t===void 0)t=We(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return Je(this,t),this}default:throw new Error(`invalid option: ${s}`)}}toString(s){return se(this,s)}[Symbol.iterator](){return this.entries()}*entries(){for(let s=0;s<this.rows;s++)for(let e=0;e<this.columns;e++)yield[s,e,this.get(s,e)]}*values(){for(let s=0;s<this.rows;s++)for(let e=0;e<this.columns;e++)yield this.get(s,e)}}X.prototype.klass="Matrix",typeof Symbol!="undefined"&&(X.prototype[Symbol.for("nodejs.util.inspect.custom")]=ke);function ne(n,s){return n-s}function Ke(n){return n.every(s=>typeof s=="number")}X.random=X.rand,X.randomInt=X.randInt,X.diagonal=X.diag,X.prototype.diagonal=X.prototype.diag,X.identity=X.eye,X.prototype.negate=X.prototype.neg,X.prototype.tensorProduct=X.prototype.kroneckerProduct;let x=(St=class extends X{constructor(e,t){super();At(this,Ct);ye(this,"data");if(St.isMatrix(e))Zt(this,Ct,Ht).call(this,e.rows,e.columns),St.copy(e,this);else if(Number.isInteger(e)&&e>=0)Zt(this,Ct,Ht).call(this,e,t);else if(ut.isAnyArray(e)){const i=e;if(e=i.length,t=e?i[0].length:0,typeof t!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let o=0;o<e;o++){if(i[o].length!==t)throw new RangeError("Inconsistent array dimensions");if(!Ke(i[o]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(i[o]))}this.rows=e,this.columns=t}else throw new TypeError("First argument must be a positive number or an array")}set(e,t,i){return this.data[e][t]=i,this}get(e,t){return this.data[e][t]}removeRow(e){return dt(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,t){return t===void 0&&(t=e,e=this.rows),dt(this,e,!0),t=Float64Array.from(kt(this,t)),this.data.splice(e,0,t),this.rows+=1,this}removeColumn(e){gt(this,e);for(let t=0;t<this.rows;t++){const i=new Float64Array(this.columns-1);for(let o=0;o<e;o++)i[o]=this.data[t][o];for(let o=e+1;o<this.columns;o++)i[o-1]=this.data[t][o];this.data[t]=i}return this.columns-=1,this}addColumn(e,t){typeof t=="undefined"&&(t=e,e=this.columns),gt(this,e,!0),t=Et(this,t);for(let i=0;i<this.rows;i++){const o=new Float64Array(this.columns+1);let r=0;for(;r<e;r++)o[r]=this.data[i][r];for(o[r++]=t[i];r<this.columns+1;r++)o[r]=this.data[i][r-1];this.data[i]=o}return this.columns+=1,this}},Ct=new WeakSet,Ht=function(e,t){if(this.data=[],Number.isInteger(t)&&t>=0)for(let i=0;i<e;i++)this.data.push(new Float64Array(t));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=t},St);Ie(X,x);const $t=class $t extends X{constructor(e){super();At(this,lt);if(x.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");Vt(this,lt,x.copy(e,new x(e.rows,e.rows)))}else if(Number.isInteger(e)&&e>=0)Vt(this,lt,new x(e,e));else if(Vt(this,lt,new x(e)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return _t(this,lt).size}get rows(){return _t(this,lt).rows}get columns(){return _t(this,lt).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return x.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}clone(){const e=new $t(this.diagonalSize);for(const[t,i,o]of this.upperRightEntries())e.set(t,i,o);return e}toMatrix(){return new x(this)}get(e,t){return _t(this,lt).get(e,t)}set(e,t,i){return _t(this,lt).set(e,t,i),_t(this,lt).set(t,e,i),this}removeCross(e){return _t(this,lt).removeRow(e),_t(this,lt).removeColumn(e),this}addCross(e,t){t===void 0&&(t=e,e=this.diagonalSize);const i=t.slice();return i.splice(e,1),_t(this,lt).addRow(e,i),_t(this,lt).addColumn(e,t),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const t=[];for(const[i,o]of e.entries())o||t.push(i);t.reverse();for(const i of t)this.removeCross(i);return this}toCompact(){const{diagonalSize:e}=this,t=new Array(e*(e+1)/2);for(let i=0,o=0,r=0;r<t.length;r++)t[r]=this.get(o,i),++i>=e&&(i=++o);return t}static fromCompact(e){const t=e.length,i=(Math.sqrt(8*t+1)-1)/2;if(!Number.isInteger(i))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const o=new $t(i);for(let r=0,l=0,h=0;h<t;h++)o.set(r,l,e[h]),++r>=i&&(r=++l);return o}*upperRightEntries(){for(let e=0,t=0;e<this.diagonalSize;void 0){const i=this.get(e,t);yield[e,t,i],++t>=this.diagonalSize&&(t=++e)}}*upperRightValues(){for(let e=0,t=0;e<this.diagonalSize;void 0)yield this.get(e,t),++t>=this.diagonalSize&&(t=++e)}};lt=new WeakMap;let Mt=$t;Mt.prototype.klassType="SymmetricMatrix";class qt extends Mt{static isDistanceMatrix(s){return Mt.isSymmetricMatrix(s)&&s.klassSubType==="DistanceMatrix"}constructor(s){if(super(s),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(s,e,t){return s===e&&(t=0),super.set(s,e,t)}addCross(s,e){return e===void 0&&(e=s,s=this.diagonalSize),e=e.slice(),e[s]=0,super.addCross(s,e)}toSymmetricMatrix(){return new Mt(this)}clone(){const s=new qt(this.diagonalSize);for(const[e,t,i]of this.upperRightEntries())e!==t&&s.set(e,t,i);return s}toCompact(){const{diagonalSize:s}=this,e=(s-1)*s/2,t=new Array(e);for(let i=1,o=0,r=0;r<t.length;r++)t[r]=this.get(o,i),++i>=s&&(i=++o+1);return t}static fromCompact(s){const e=s.length;if(e===0)return new this(0);const t=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(t))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(s)}`);const i=new this(t);for(let o=1,r=0,l=0;l<e;l++)i.set(o,r,s[l]),++o>=t&&(o=++r+1);return i}}qt.prototype.klassSubType="DistanceMatrix";class vt extends X{constructor(s,e,t){super(),this.matrix=s,this.rows=e,this.columns=t}}class Qe extends vt{constructor(s,e){gt(s,e),super(s,s.rows,1),this.column=e}set(s,e,t){return this.matrix.set(s,this.column,t),this}get(s){return this.matrix.get(s,this.column)}}class Ae extends vt{constructor(s,e){Wt(s,e),super(s,s.rows,e.length),this.columnIndices=e}set(s,e,t){return this.matrix.set(s,this.columnIndices[e],t),this}get(s,e){return this.matrix.get(s,this.columnIndices[e])}}class Ze extends vt{constructor(s){super(s,s.rows,s.columns)}set(s,e,t){return this.matrix.set(s,this.columns-e-1,t),this}get(s,e){return this.matrix.get(s,this.columns-e-1)}}class He extends vt{constructor(s){super(s,s.rows,s.columns)}set(s,e,t){return this.matrix.set(this.rows-s-1,e,t),this}get(s,e){return this.matrix.get(this.rows-s-1,e)}}class ti extends vt{constructor(s,e){dt(s,e),super(s,1,s.columns),this.row=e}set(s,e,t){return this.matrix.set(this.row,e,t),this}get(s,e){return this.matrix.get(this.row,e)}}class ei extends vt{constructor(s,e){Ut(s,e),super(s,e.length,s.columns),this.rowIndices=e}set(s,e,t){return this.matrix.set(this.rowIndices[s],e,t),this}get(s,e){return this.matrix.get(this.rowIndices[s],e)}}class Xt extends vt{constructor(s,e,t){Ut(s,e),Wt(s,t),super(s,e.length,t.length),this.rowIndices=e,this.columnIndices=t}set(s,e,t){return this.matrix.set(this.rowIndices[s],this.columnIndices[e],t),this}get(s,e){return this.matrix.get(this.rowIndices[s],this.columnIndices[e])}}class ii extends vt{constructor(s,e,t,i,o){Jt(s,e,t,i,o),super(s,t-e+1,o-i+1),this.startRow=e,this.startColumn=i}set(s,e,t){return this.matrix.set(this.startRow+s,this.startColumn+e,t),this}get(s,e){return this.matrix.get(this.startRow+s,this.startColumn+e)}}class si extends vt{constructor(s){super(s,s.columns,s.rows)}set(s,e,t){return this.matrix.set(e,s,t),this}get(s,e){return this.matrix.get(e,s)}}class re extends X{constructor(s,e={}){const{rows:t=1}=e;if(s.length%t!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=t,this.columns=s.length/t,this.data=s}set(s,e,t){let i=this._calculateIndex(s,e);return this.data[i]=t,this}get(s,e){let t=this._calculateIndex(s,e);return this.data[t]}_calculateIndex(s,e){return s*this.columns+e}}class ft extends X{constructor(s){super(),this.data=s,this.rows=s.length,this.columns=s[0].length}set(s,e,t){return this.data[s][e]=t,this}get(s,e){return this.data[s][e]}}function oi(n,s){if(ut.isAnyArray(n))return n[0]&&ut.isAnyArray(n[0])?new ft(n):new re(n,s);throw new Error("the argument is not an array")}class Dt{constructor(s){s=ft.checkMatrix(s);let e=s.clone(),t=e.rows,i=e.columns,o=new Float64Array(t),r=1,l,h,u,m,a,d,M,p,g;for(l=0;l<t;l++)o[l]=l;for(p=new Float64Array(t),h=0;h<i;h++){for(l=0;l<t;l++)p[l]=e.get(l,h);for(l=0;l<t;l++){for(g=Math.min(l,h),a=0,u=0;u<g;u++)a+=e.get(l,u)*p[u];p[l]-=a,e.set(l,h,p[l])}for(m=h,l=h+1;l<t;l++)Math.abs(p[l])>Math.abs(p[m])&&(m=l);if(m!==h){for(u=0;u<i;u++)d=e.get(m,u),e.set(m,u,e.get(h,u)),e.set(h,u,d);M=o[m],o[m]=o[h],o[h]=M,r=-r}if(h<t&&e.get(h,h)!==0)for(l=h+1;l<t;l++)e.set(l,h,e.get(l,h)/e.get(h,h))}this.LU=e,this.pivotVector=o,this.pivotSign=r}isSingular(){let s=this.LU,e=s.columns;for(let t=0;t<e;t++)if(s.get(t,t)===0)return!0;return!1}solve(s){s=x.checkMatrix(s);let e=this.LU;if(e.rows!==s.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let i=s.columns,o=s.subMatrixRow(this.pivotVector,0,i-1),r=e.columns,l,h,u;for(u=0;u<r;u++)for(l=u+1;l<r;l++)for(h=0;h<i;h++)o.set(l,h,o.get(l,h)-o.get(u,h)*e.get(l,u));for(u=r-1;u>=0;u--){for(h=0;h<i;h++)o.set(u,h,o.get(u,h)/e.get(u,u));for(l=0;l<u;l++)for(h=0;h<i;h++)o.set(l,h,o.get(l,h)-o.get(u,h)*e.get(l,u))}return o}get determinant(){let s=this.LU;if(!s.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,t=s.columns;for(let i=0;i<t;i++)e*=s.get(i,i);return e}get lowerTriangularMatrix(){let s=this.LU,e=s.rows,t=s.columns,i=new x(e,t);for(let o=0;o<e;o++)for(let r=0;r<t;r++)o>r?i.set(o,r,s.get(o,r)):o===r?i.set(o,r,1):i.set(o,r,0);return i}get upperTriangularMatrix(){let s=this.LU,e=s.rows,t=s.columns,i=new x(e,t);for(let o=0;o<e;o++)for(let r=0;r<t;r++)o<=r?i.set(o,r,s.get(o,r)):i.set(o,r,0);return i}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function Tt(n,s){let e=0;return Math.abs(n)>Math.abs(s)?(e=s/n,Math.abs(n)*Math.sqrt(1+e*e)):s!==0?(e=n/s,Math.abs(s)*Math.sqrt(1+e*e)):0}class Kt{constructor(s){s=ft.checkMatrix(s);let e=s.clone(),t=s.rows,i=s.columns,o=new Float64Array(i),r,l,h,u;for(h=0;h<i;h++){let m=0;for(r=h;r<t;r++)m=Tt(m,e.get(r,h));if(m!==0){for(e.get(h,h)<0&&(m=-m),r=h;r<t;r++)e.set(r,h,e.get(r,h)/m);for(e.set(h,h,e.get(h,h)+1),l=h+1;l<i;l++){for(u=0,r=h;r<t;r++)u+=e.get(r,h)*e.get(r,l);for(u=-u/e.get(h,h),r=h;r<t;r++)e.set(r,l,e.get(r,l)+u*e.get(r,h))}}o[h]=-m}this.QR=e,this.Rdiag=o}solve(s){s=x.checkMatrix(s);let e=this.QR,t=e.rows;if(s.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let i=s.columns,o=s.clone(),r=e.columns,l,h,u,m;for(u=0;u<r;u++)for(h=0;h<i;h++){for(m=0,l=u;l<t;l++)m+=e.get(l,u)*o.get(l,h);for(m=-m/e.get(u,u),l=u;l<t;l++)o.set(l,h,o.get(l,h)+m*e.get(l,u))}for(u=r-1;u>=0;u--){for(h=0;h<i;h++)o.set(u,h,o.get(u,h)/this.Rdiag[u]);for(l=0;l<u;l++)for(h=0;h<i;h++)o.set(l,h,o.get(l,h)-o.get(u,h)*e.get(l,u))}return o.subMatrix(0,r-1,0,i-1)}isFullRank(){let s=this.QR.columns;for(let e=0;e<s;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let s=this.QR,e=s.columns,t=new x(e,e),i,o;for(i=0;i<e;i++)for(o=0;o<e;o++)i<o?t.set(i,o,s.get(i,o)):i===o?t.set(i,o,this.Rdiag[i]):t.set(i,o,0);return t}get orthogonalMatrix(){let s=this.QR,e=s.rows,t=s.columns,i=new x(e,t),o,r,l,h;for(l=t-1;l>=0;l--){for(o=0;o<e;o++)i.set(o,l,0);for(i.set(l,l,1),r=l;r<t;r++)if(s.get(l,l)!==0){for(h=0,o=l;o<e;o++)h+=s.get(o,l)*i.get(o,r);for(h=-h/s.get(l,l),o=l;o<e;o++)i.set(o,r,i.get(o,r)+h*s.get(o,l))}}return i}}class It{constructor(s,e={}){if(s=ft.checkMatrix(s),s.isEmpty())throw new Error("Matrix must be non-empty");let t=s.rows,i=s.columns;const{computeLeftSingularVectors:o=!0,computeRightSingularVectors:r=!0,autoTranspose:l=!1}=e;let h=!!o,u=!!r,m=!1,a;if(t<i)if(!l)a=s.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{a=s.transpose(),t=a.rows,i=a.columns,m=!0;let c=h;h=u,u=c}else a=s.clone();let d=Math.min(t,i),M=Math.min(t+1,i),p=new Float64Array(M),g=new x(t,d),P=new x(i,i),f=new Float64Array(i),T=new Float64Array(t),I=new Float64Array(M);for(let c=0;c<M;c++)I[c]=c;let Y=Math.min(t-1,i),F=Math.max(0,Math.min(i-2,t)),V=Math.max(Y,F);for(let c=0;c<V;c++){if(c<Y){p[c]=0;for(let y=c;y<t;y++)p[c]=Tt(p[c],a.get(y,c));if(p[c]!==0){a.get(c,c)<0&&(p[c]=-p[c]);for(let y=c;y<t;y++)a.set(y,c,a.get(y,c)/p[c]);a.set(c,c,a.get(c,c)+1)}p[c]=-p[c]}for(let y=c+1;y<i;y++){if(c<Y&&p[c]!==0){let k=0;for(let v=c;v<t;v++)k+=a.get(v,c)*a.get(v,y);k=-k/a.get(c,c);for(let v=c;v<t;v++)a.set(v,y,a.get(v,y)+k*a.get(v,c))}f[y]=a.get(c,y)}if(h&&c<Y)for(let y=c;y<t;y++)g.set(y,c,a.get(y,c));if(c<F){f[c]=0;for(let y=c+1;y<i;y++)f[c]=Tt(f[c],f[y]);if(f[c]!==0){f[c+1]<0&&(f[c]=0-f[c]);for(let y=c+1;y<i;y++)f[y]/=f[c];f[c+1]+=1}if(f[c]=-f[c],c+1<t&&f[c]!==0){for(let y=c+1;y<t;y++)T[y]=0;for(let y=c+1;y<t;y++)for(let k=c+1;k<i;k++)T[y]+=f[k]*a.get(y,k);for(let y=c+1;y<i;y++){let k=-f[y]/f[c+1];for(let v=c+1;v<t;v++)a.set(v,y,a.get(v,y)+k*T[v])}}if(u)for(let y=c+1;y<i;y++)P.set(y,c,f[y])}}let E=Math.min(i,t+1);if(Y<i&&(p[Y]=a.get(Y,Y)),t<E&&(p[E-1]=0),F+1<E&&(f[F]=a.get(F,E-1)),f[E-1]=0,h){for(let c=Y;c<d;c++){for(let y=0;y<t;y++)g.set(y,c,0);g.set(c,c,1)}for(let c=Y-1;c>=0;c--)if(p[c]!==0){for(let y=c+1;y<d;y++){let k=0;for(let v=c;v<t;v++)k+=g.get(v,c)*g.get(v,y);k=-k/g.get(c,c);for(let v=c;v<t;v++)g.set(v,y,g.get(v,y)+k*g.get(v,c))}for(let y=c;y<t;y++)g.set(y,c,-g.get(y,c));g.set(c,c,1+g.get(c,c));for(let y=0;y<c-1;y++)g.set(y,c,0)}else{for(let y=0;y<t;y++)g.set(y,c,0);g.set(c,c,1)}}if(u)for(let c=i-1;c>=0;c--){if(c<F&&f[c]!==0)for(let y=c+1;y<i;y++){let k=0;for(let v=c+1;v<i;v++)k+=P.get(v,c)*P.get(v,y);k=-k/P.get(c+1,c);for(let v=c+1;v<i;v++)P.set(v,y,P.get(v,y)+k*P.get(v,c))}for(let y=0;y<i;y++)P.set(y,c,0);P.set(c,c,1)}let C=E-1,$=Number.EPSILON;for(;E>0;){let c,y;for(c=E-2;c>=-1&&c!==-1;c--){const k=Number.MIN_VALUE+$*Math.abs(p[c]+Math.abs(p[c+1]));if(Math.abs(f[c])<=k||Number.isNaN(f[c])){f[c]=0;break}}if(c===E-2)y=4;else{let k;for(k=E-1;k>=c&&k!==c;k--){let v=(k!==E?Math.abs(f[k]):0)+(k!==c+1?Math.abs(f[k-1]):0);if(Math.abs(p[k])<=$*v){p[k]=0;break}}k===c?y=3:k===E-1?y=1:(y=2,c=k)}switch(c++,y){case 1:{let k=f[E-2];f[E-2]=0;for(let v=E-2;v>=c;v--){let O=Tt(p[v],k),D=p[v]/O,B=k/O;if(p[v]=O,v!==c&&(k=-B*f[v-1],f[v-1]=D*f[v-1]),u)for(let S=0;S<i;S++)O=D*P.get(S,v)+B*P.get(S,E-1),P.set(S,E-1,-B*P.get(S,v)+D*P.get(S,E-1)),P.set(S,v,O)}break}case 2:{let k=f[c-1];f[c-1]=0;for(let v=c;v<E;v++){let O=Tt(p[v],k),D=p[v]/O,B=k/O;if(p[v]=O,k=-B*f[v],f[v]=D*f[v],h)for(let S=0;S<t;S++)O=D*g.get(S,v)+B*g.get(S,c-1),g.set(S,c-1,-B*g.get(S,v)+D*g.get(S,c-1)),g.set(S,v,O)}break}case 3:{const k=Math.max(Math.abs(p[E-1]),Math.abs(p[E-2]),Math.abs(f[E-2]),Math.abs(p[c]),Math.abs(f[c])),v=p[E-1]/k,O=p[E-2]/k,D=f[E-2]/k,B=p[c]/k,S=f[c]/k,H=((O+v)*(O-v)+D*D)/2,ct=v*D*(v*D);let Z=0;(H!==0||ct!==0)&&(H<0?Z=0-Math.sqrt(H*H+ct):Z=Math.sqrt(H*H+ct),Z=ct/(H+Z));let at=(B+v)*(B-v)+Z,nt=B*S;for(let q=c;q<E-1;q++){let tt=Tt(at,nt);tt===0&&(tt=Number.MIN_VALUE);let it=at/tt,st=nt/tt;if(q!==c&&(f[q-1]=tt),at=it*p[q]+st*f[q],f[q]=it*f[q]-st*p[q],nt=st*p[q+1],p[q+1]=it*p[q+1],u)for(let J=0;J<i;J++)tt=it*P.get(J,q)+st*P.get(J,q+1),P.set(J,q+1,-st*P.get(J,q)+it*P.get(J,q+1)),P.set(J,q,tt);if(tt=Tt(at,nt),tt===0&&(tt=Number.MIN_VALUE),it=at/tt,st=nt/tt,p[q]=tt,at=it*f[q]+st*p[q+1],p[q+1]=-st*f[q]+it*p[q+1],nt=st*f[q+1],f[q+1]=it*f[q+1],h&&q<t-1)for(let J=0;J<t;J++)tt=it*g.get(J,q)+st*g.get(J,q+1),g.set(J,q+1,-st*g.get(J,q)+it*g.get(J,q+1)),g.set(J,q,tt)}f[E-2]=at;break}case 4:{if(p[c]<=0&&(p[c]=p[c]<0?-p[c]:0,u))for(let k=0;k<=C;k++)P.set(k,c,-P.get(k,c));for(;c<C&&!(p[c]>=p[c+1]);){let k=p[c];if(p[c]=p[c+1],p[c+1]=k,u&&c<i-1)for(let v=0;v<i;v++)k=P.get(v,c+1),P.set(v,c+1,P.get(v,c)),P.set(v,c,k);if(h&&c<t-1)for(let v=0;v<t;v++)k=g.get(v,c+1),g.set(v,c+1,g.get(v,c)),g.set(v,c,k);c++}E--;break}}}if(m){let c=P;P=g,g=c}this.m=t,this.n=i,this.s=p,this.U=g,this.V=P}solve(s){let e=s,t=this.threshold,i=this.s.length,o=x.zeros(i,i);for(let d=0;d<i;d++)Math.abs(this.s[d])<=t?o.set(d,d,0):o.set(d,d,1/this.s[d]);let r=this.U,l=this.rightSingularVectors,h=l.mmul(o),u=l.rows,m=r.rows,a=x.zeros(u,m);for(let d=0;d<u;d++)for(let M=0;M<m;M++){let p=0;for(let g=0;g<i;g++)p+=h.get(d,g)*r.get(M,g);a.set(d,M,p)}return a.mmul(e)}solveForDiagonal(s){return this.solve(x.diag(s))}inverse(){let s=this.V,e=this.threshold,t=s.rows,i=s.columns,o=new x(t,this.s.length);for(let m=0;m<t;m++)for(let a=0;a<i;a++)Math.abs(this.s[a])>e&&o.set(m,a,s.get(m,a)/this.s[a]);let r=this.U,l=r.rows,h=r.columns,u=new x(t,l);for(let m=0;m<t;m++)for(let a=0;a<l;a++){let d=0;for(let M=0;M<h;M++)d+=o.get(m,M)*r.get(a,M);u.set(m,a,d)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let s=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,t=this.s;for(let i=0,o=t.length;i<o;i++)t[i]>s&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return x.diag(this.s)}}function ni(n,s=!1){return n=ft.checkMatrix(n),s?new It(n).inverse():le(n,x.eye(n.rows))}function le(n,s,e=!1){return n=ft.checkMatrix(n),s=ft.checkMatrix(s),e?new It(n).solve(s):n.isSquare()?new Dt(n).solve(s):new Kt(n).solve(s)}function zt(n){if(n=x.checkMatrix(n),n.isSquare()){if(n.columns===0)return 1;let s,e,t,i;if(n.columns===2)return s=n.get(0,0),e=n.get(0,1),t=n.get(1,0),i=n.get(1,1),s*i-e*t;if(n.columns===3){let o,r,l;return o=new Xt(n,[1,2],[1,2]),r=new Xt(n,[1,2],[0,2]),l=new Xt(n,[1,2],[0,1]),s=n.get(0,0),e=n.get(0,1),t=n.get(0,2),s*zt(o)-e*zt(r)+t*zt(l)}else return new Dt(n).determinant}else throw Error("determinant can only be calculated for a square matrix")}function ri(n,s){let e=[];for(let t=0;t<n;t++)t!==s&&e.push(t);return e}function li(n,s,e,t=1e-9,i=1e-9){if(n>i)return new Array(s.rows+1).fill(0);{let o=s.addRow(e,[0]);for(let r=0;r<o.rows;r++)Math.abs(o.get(r,0))<t&&o.set(r,0,0);return o.to1DArray()}}function hi(n,s={}){const{thresholdValue:e=1e-9,thresholdError:t=1e-9}=s;n=x.checkMatrix(n);let i=n.rows,o=new x(i,i);for(let r=0;r<i;r++){let l=x.columnVector(n.getRow(r)),h=n.subMatrixRow(ri(i,r)).transpose(),m=new It(h).solve(l),a=x.sub(l,h.mmul(m)).abs().max();o.setRow(r,li(a,m,r,e,t))}return o}function ui(n,s=Number.EPSILON){if(n=x.checkMatrix(n),n.isEmpty())return n.transpose();let e=new It(n,{autoTranspose:!0}),t=e.leftSingularVectors,i=e.rightSingularVectors,o=e.diagonal;for(let r=0;r<o.length;r++)Math.abs(o[r])>s?o[r]=1/o[r]:o[r]=0;return i.mmul(x.diag(o).mmul(t.transpose()))}function ai(n,s=n,e={}){n=new x(n);let t=!1;if(typeof s=="object"&&!x.isMatrix(s)&&!ut.isAnyArray(s)?(e=s,s=n,t=!0):s=new x(s),n.rows!==s.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:i=!0}=e;i&&(n=n.center("column"),t||(s=s.center("column")));const o=n.transpose().mmul(s);for(let r=0;r<o.rows;r++)for(let l=0;l<o.columns;l++)o.set(r,l,o.get(r,l)*(1/(n.rows-1)));return o}function fi(n,s=n,e={}){n=new x(n);let t=!1;if(typeof s=="object"&&!x.isMatrix(s)&&!ut.isAnyArray(s)?(e=s,s=n,t=!0):s=new x(s),n.rows!==s.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:i=!0,scale:o=!0}=e;i&&(n.center("column"),t||s.center("column")),o&&(n.scale("column"),t||s.scale("column"));const r=n.standardDeviation("column",{unbiased:!0}),l=t?r:s.standardDeviation("column",{unbiased:!0}),h=n.transpose().mmul(s);for(let u=0;u<h.rows;u++)for(let m=0;m<h.columns;m++)h.set(u,m,h.get(u,m)*(1/(r[u]*l[m]))*(1/(n.rows-1)));return h}class he{constructor(s,e={}){const{assumeSymmetric:t=!1}=e;if(s=ft.checkMatrix(s),!s.isSquare())throw new Error("Matrix is not a square matrix");if(s.isEmpty())throw new Error("Matrix must be non-empty");let i=s.columns,o=new x(i,i),r=new Float64Array(i),l=new Float64Array(i),h=s,u,m,a=!1;if(t?a=!0:a=s.isSymmetric(),a){for(u=0;u<i;u++)for(m=0;m<i;m++)o.set(u,m,h.get(u,m));ci(i,l,r,o),mi(i,l,r,o)}else{let d=new x(i,i),M=new Float64Array(i);for(m=0;m<i;m++)for(u=0;u<i;u++)d.set(u,m,h.get(u,m));pi(i,d,M,o),di(i,l,r,o,d)}this.n=i,this.e=l,this.d=r,this.V=o}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let s=this.n,e=this.e,t=this.d,i=new x(s,s),o,r;for(o=0;o<s;o++){for(r=0;r<s;r++)i.set(o,r,0);i.set(o,o,t[o]),e[o]>0?i.set(o,o+1,e[o]):e[o]<0&&i.set(o,o-1,e[o])}return i}}function ci(n,s,e,t){let i,o,r,l,h,u,m,a;for(h=0;h<n;h++)e[h]=t.get(n-1,h);for(l=n-1;l>0;l--){for(a=0,r=0,u=0;u<l;u++)a=a+Math.abs(e[u]);if(a===0)for(s[l]=e[l-1],h=0;h<l;h++)e[h]=t.get(l-1,h),t.set(l,h,0),t.set(h,l,0);else{for(u=0;u<l;u++)e[u]/=a,r+=e[u]*e[u];for(i=e[l-1],o=Math.sqrt(r),i>0&&(o=-o),s[l]=a*o,r=r-i*o,e[l-1]=i-o,h=0;h<l;h++)s[h]=0;for(h=0;h<l;h++){for(i=e[h],t.set(h,l,i),o=s[h]+t.get(h,h)*i,u=h+1;u<=l-1;u++)o+=t.get(u,h)*e[u],s[u]+=t.get(u,h)*i;s[h]=o}for(i=0,h=0;h<l;h++)s[h]/=r,i+=s[h]*e[h];for(m=i/(r+r),h=0;h<l;h++)s[h]-=m*e[h];for(h=0;h<l;h++){for(i=e[h],o=s[h],u=h;u<=l-1;u++)t.set(u,h,t.get(u,h)-(i*s[u]+o*e[u]));e[h]=t.get(l-1,h),t.set(l,h,0)}}e[l]=r}for(l=0;l<n-1;l++){if(t.set(n-1,l,t.get(l,l)),t.set(l,l,1),r=e[l+1],r!==0){for(u=0;u<=l;u++)e[u]=t.get(u,l+1)/r;for(h=0;h<=l;h++){for(o=0,u=0;u<=l;u++)o+=t.get(u,l+1)*t.get(u,h);for(u=0;u<=l;u++)t.set(u,h,t.get(u,h)-o*e[u])}}for(u=0;u<=l;u++)t.set(u,l+1,0)}for(h=0;h<n;h++)e[h]=t.get(n-1,h),t.set(n-1,h,0);t.set(n-1,n-1,1),s[0]=0}function mi(n,s,e,t){let i,o,r,l,h,u,m,a,d,M,p,g,P,f,T,I;for(r=1;r<n;r++)s[r-1]=s[r];s[n-1]=0;let Y=0,F=0,V=Number.EPSILON;for(u=0;u<n;u++){for(F=Math.max(F,Math.abs(e[u])+Math.abs(s[u])),m=u;m<n&&!(Math.abs(s[m])<=V*F);)m++;if(m>u)do{for(i=e[u],a=(e[u+1]-i)/(2*s[u]),d=Tt(a,1),a<0&&(d=-d),e[u]=s[u]/(a+d),e[u+1]=s[u]*(a+d),M=e[u+1],o=i-e[u],r=u+2;r<n;r++)e[r]-=o;for(Y=Y+o,a=e[m],p=1,g=p,P=p,f=s[u+1],T=0,I=0,r=m-1;r>=u;r--)for(P=g,g=p,I=T,i=p*s[r],o=p*a,d=Tt(a,s[r]),s[r+1]=T*d,T=s[r]/d,p=a/d,a=p*e[r]-T*i,e[r+1]=o+T*(p*i+T*e[r]),h=0;h<n;h++)o=t.get(h,r+1),t.set(h,r+1,T*t.get(h,r)+p*o),t.set(h,r,p*t.get(h,r)-T*o);a=-T*I*P*f*s[u]/M,s[u]=T*a,e[u]=p*a}while(Math.abs(s[u])>V*F);e[u]=e[u]+Y,s[u]=0}for(r=0;r<n-1;r++){for(h=r,a=e[r],l=r+1;l<n;l++)e[l]<a&&(h=l,a=e[l]);if(h!==r)for(e[h]=e[r],e[r]=a,l=0;l<n;l++)a=t.get(l,r),t.set(l,r,t.get(l,h)),t.set(l,h,a)}}function pi(n,s,e,t){let i=0,o=n-1,r,l,h,u,m,a,d;for(a=i+1;a<=o-1;a++){for(d=0,u=a;u<=o;u++)d=d+Math.abs(s.get(u,a-1));if(d!==0){for(h=0,u=o;u>=a;u--)e[u]=s.get(u,a-1)/d,h+=e[u]*e[u];for(l=Math.sqrt(h),e[a]>0&&(l=-l),h=h-e[a]*l,e[a]=e[a]-l,m=a;m<n;m++){for(r=0,u=o;u>=a;u--)r+=e[u]*s.get(u,m);for(r=r/h,u=a;u<=o;u++)s.set(u,m,s.get(u,m)-r*e[u])}for(u=0;u<=o;u++){for(r=0,m=o;m>=a;m--)r+=e[m]*s.get(u,m);for(r=r/h,m=a;m<=o;m++)s.set(u,m,s.get(u,m)-r*e[m])}e[a]=d*e[a],s.set(a,a-1,d*l)}}for(u=0;u<n;u++)for(m=0;m<n;m++)t.set(u,m,u===m?1:0);for(a=o-1;a>=i+1;a--)if(s.get(a,a-1)!==0){for(u=a+1;u<=o;u++)e[u]=s.get(u,a-1);for(m=a;m<=o;m++){for(l=0,u=a;u<=o;u++)l+=e[u]*t.get(u,m);for(l=l/e[a]/s.get(a,a-1),u=a;u<=o;u++)t.set(u,m,t.get(u,m)+l*e[u])}}}function di(n,s,e,t,i){let o=n-1,r=0,l=n-1,h=Number.EPSILON,u=0,m=0,a=0,d=0,M=0,p=0,g=0,P=0,f,T,I,Y,F,V,E,C,$,c,y,k,v,O,D;for(f=0;f<n;f++)for((f<r||f>l)&&(e[f]=i.get(f,f),s[f]=0),T=Math.max(f-1,0);T<n;T++)m=m+Math.abs(i.get(f,T));for(;o>=r;){for(Y=o;Y>r&&(p=Math.abs(i.get(Y-1,Y-1))+Math.abs(i.get(Y,Y)),p===0&&(p=m),!(Math.abs(i.get(Y,Y-1))<h*p));)Y--;if(Y===o)i.set(o,o,i.get(o,o)+u),e[o]=i.get(o,o),s[o]=0,o--,P=0;else if(Y===o-1){if(E=i.get(o,o-1)*i.get(o-1,o),a=(i.get(o-1,o-1)-i.get(o,o))/2,d=a*a+E,g=Math.sqrt(Math.abs(d)),i.set(o,o,i.get(o,o)+u),i.set(o-1,o-1,i.get(o-1,o-1)+u),C=i.get(o,o),d>=0){for(g=a>=0?a+g:a-g,e[o-1]=C+g,e[o]=e[o-1],g!==0&&(e[o]=C-E/g),s[o-1]=0,s[o]=0,C=i.get(o,o-1),p=Math.abs(C)+Math.abs(g),a=C/p,d=g/p,M=Math.sqrt(a*a+d*d),a=a/M,d=d/M,T=o-1;T<n;T++)g=i.get(o-1,T),i.set(o-1,T,d*g+a*i.get(o,T)),i.set(o,T,d*i.get(o,T)-a*g);for(f=0;f<=o;f++)g=i.get(f,o-1),i.set(f,o-1,d*g+a*i.get(f,o)),i.set(f,o,d*i.get(f,o)-a*g);for(f=r;f<=l;f++)g=t.get(f,o-1),t.set(f,o-1,d*g+a*t.get(f,o)),t.set(f,o,d*t.get(f,o)-a*g)}else e[o-1]=C+a,e[o]=C+a,s[o-1]=g,s[o]=-g;o=o-2,P=0}else{if(C=i.get(o,o),$=0,E=0,Y<o&&($=i.get(o-1,o-1),E=i.get(o,o-1)*i.get(o-1,o)),P===10){for(u+=C,f=r;f<=o;f++)i.set(f,f,i.get(f,f)-C);p=Math.abs(i.get(o,o-1))+Math.abs(i.get(o-1,o-2)),C=$=.75*p,E=-.4375*p*p}if(P===30&&(p=($-C)/2,p=p*p+E,p>0)){for(p=Math.sqrt(p),$<C&&(p=-p),p=C-E/(($-C)/2+p),f=r;f<=o;f++)i.set(f,f,i.get(f,f)-p);u+=p,C=$=E=.964}for(P=P+1,F=o-2;F>=Y&&(g=i.get(F,F),M=C-g,p=$-g,a=(M*p-E)/i.get(F+1,F)+i.get(F,F+1),d=i.get(F+1,F+1)-g-M-p,M=i.get(F+2,F+1),p=Math.abs(a)+Math.abs(d)+Math.abs(M),a=a/p,d=d/p,M=M/p,!(F===Y||Math.abs(i.get(F,F-1))*(Math.abs(d)+Math.abs(M))<h*(Math.abs(a)*(Math.abs(i.get(F-1,F-1))+Math.abs(g)+Math.abs(i.get(F+1,F+1))))));)F--;for(f=F+2;f<=o;f++)i.set(f,f-2,0),f>F+2&&i.set(f,f-3,0);for(I=F;I<=o-1&&(O=I!==o-1,I!==F&&(a=i.get(I,I-1),d=i.get(I+1,I-1),M=O?i.get(I+2,I-1):0,C=Math.abs(a)+Math.abs(d)+Math.abs(M),C!==0&&(a=a/C,d=d/C,M=M/C)),C!==0);I++)if(p=Math.sqrt(a*a+d*d+M*M),a<0&&(p=-p),p!==0){for(I!==F?i.set(I,I-1,-p*C):Y!==F&&i.set(I,I-1,-i.get(I,I-1)),a=a+p,C=a/p,$=d/p,g=M/p,d=d/a,M=M/a,T=I;T<n;T++)a=i.get(I,T)+d*i.get(I+1,T),O&&(a=a+M*i.get(I+2,T),i.set(I+2,T,i.get(I+2,T)-a*g)),i.set(I,T,i.get(I,T)-a*C),i.set(I+1,T,i.get(I+1,T)-a*$);for(f=0;f<=Math.min(o,I+3);f++)a=C*i.get(f,I)+$*i.get(f,I+1),O&&(a=a+g*i.get(f,I+2),i.set(f,I+2,i.get(f,I+2)-a*M)),i.set(f,I,i.get(f,I)-a),i.set(f,I+1,i.get(f,I+1)-a*d);for(f=r;f<=l;f++)a=C*t.get(f,I)+$*t.get(f,I+1),O&&(a=a+g*t.get(f,I+2),t.set(f,I+2,t.get(f,I+2)-a*M)),t.set(f,I,t.get(f,I)-a),t.set(f,I+1,t.get(f,I+1)-a*d)}}}if(m!==0){for(o=n-1;o>=0;o--)if(a=e[o],d=s[o],d===0)for(Y=o,i.set(o,o,1),f=o-1;f>=0;f--){for(E=i.get(f,f)-a,M=0,T=Y;T<=o;T++)M=M+i.get(f,T)*i.get(T,o);if(s[f]<0)g=E,p=M;else if(Y=f,s[f]===0?i.set(f,o,E!==0?-M/E:-M/(h*m)):(C=i.get(f,f+1),$=i.get(f+1,f),d=(e[f]-a)*(e[f]-a)+s[f]*s[f],V=(C*p-g*M)/d,i.set(f,o,V),i.set(f+1,o,Math.abs(C)>Math.abs(g)?(-M-E*V)/C:(-p-$*V)/g)),V=Math.abs(i.get(f,o)),h*V*V>1)for(T=f;T<=o;T++)i.set(T,o,i.get(T,o)/V)}else if(d<0)for(Y=o-1,Math.abs(i.get(o,o-1))>Math.abs(i.get(o-1,o))?(i.set(o-1,o-1,d/i.get(o,o-1)),i.set(o-1,o,-(i.get(o,o)-a)/i.get(o,o-1))):(D=Bt(0,-i.get(o-1,o),i.get(o-1,o-1)-a,d),i.set(o-1,o-1,D[0]),i.set(o-1,o,D[1])),i.set(o,o-1,0),i.set(o,o,1),f=o-2;f>=0;f--){for(c=0,y=0,T=Y;T<=o;T++)c=c+i.get(f,T)*i.get(T,o-1),y=y+i.get(f,T)*i.get(T,o);if(E=i.get(f,f)-a,s[f]<0)g=E,M=c,p=y;else if(Y=f,s[f]===0?(D=Bt(-c,-y,E,d),i.set(f,o-1,D[0]),i.set(f,o,D[1])):(C=i.get(f,f+1),$=i.get(f+1,f),k=(e[f]-a)*(e[f]-a)+s[f]*s[f]-d*d,v=(e[f]-a)*2*d,k===0&&v===0&&(k=h*m*(Math.abs(E)+Math.abs(d)+Math.abs(C)+Math.abs($)+Math.abs(g))),D=Bt(C*M-g*c+d*y,C*p-g*y-d*c,k,v),i.set(f,o-1,D[0]),i.set(f,o,D[1]),Math.abs(C)>Math.abs(g)+Math.abs(d)?(i.set(f+1,o-1,(-c-E*i.get(f,o-1)+d*i.get(f,o))/C),i.set(f+1,o,(-y-E*i.get(f,o)-d*i.get(f,o-1))/C)):(D=Bt(-M-$*i.get(f,o-1),-p-$*i.get(f,o),g,d),i.set(f+1,o-1,D[0]),i.set(f+1,o,D[1]))),V=Math.max(Math.abs(i.get(f,o-1)),Math.abs(i.get(f,o))),h*V*V>1)for(T=f;T<=o;T++)i.set(T,o-1,i.get(T,o-1)/V),i.set(T,o,i.get(T,o)/V)}for(f=0;f<n;f++)if(f<r||f>l)for(T=f;T<n;T++)t.set(f,T,i.get(f,T));for(T=n-1;T>=r;T--)for(f=r;f<=l;f++){for(g=0,I=r;I<=Math.min(T,l);I++)g=g+t.get(f,I)*i.get(I,T);t.set(f,T,g)}}}function Bt(n,s,e,t){let i,o;return Math.abs(e)>Math.abs(t)?(i=t/e,o=e+i*t,[(n+i*s)/o,(s-i*n)/o]):(i=e/t,o=t+i*e,[(i*n+s)/o,(i*s-n)/o])}class ue{constructor(s){if(s=ft.checkMatrix(s),!s.isSymmetric())throw new Error("Matrix is not symmetric");let e=s,t=e.rows,i=new x(t,t),o=!0,r,l,h;for(l=0;l<t;l++){let u=0;for(h=0;h<l;h++){let m=0;for(r=0;r<h;r++)m+=i.get(h,r)*i.get(l,r);m=(e.get(l,h)-m)/i.get(h,h),i.set(l,h,m),u=u+m*m}for(u=e.get(l,l)-u,o&&(o=u>0),i.set(l,l,Math.sqrt(Math.max(u,0))),h=l+1;h<t;h++)i.set(l,h,0)}this.L=i,this.positiveDefinite=o}isPositiveDefinite(){return this.positiveDefinite}solve(s){s=ft.checkMatrix(s);let e=this.L,t=e.rows;if(s.rows!==t)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let i=s.columns,o=s.clone(),r,l,h;for(h=0;h<t;h++)for(l=0;l<i;l++){for(r=0;r<h;r++)o.set(h,l,o.get(h,l)-o.get(r,l)*e.get(h,r));o.set(h,l,o.get(h,l)/e.get(h,h))}for(h=t-1;h>=0;h--)for(l=0;l<i;l++){for(r=h+1;r<t;r++)o.set(h,l,o.get(h,l)-o.get(r,l)*e.get(r,h));o.set(h,l,o.get(h,l)/e.get(h,h))}return o}get lowerTriangularMatrix(){return this.L}}class ae{constructor(s,e={}){s=ft.checkMatrix(s);let{Y:t}=e;const{scaleScores:i=!1,maxIterations:o=1e3,terminationCriteria:r=1e-10}=e;let l;if(t){if(ut.isAnyArray(t)&&typeof t[0]=="number"?t=x.columnVector(t):t=ft.checkMatrix(t),t.rows!==s.rows)throw new Error("Y should have the same number of rows as X");l=t.getColumnVector(0)}else l=s.getColumnVector(0);let h=1,u,m,a,d;for(let M=0;M<o&&h>r;M++)a=s.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),a=a.div(a.norm()),u=s.mmul(a).div(a.transpose().mmul(a).get(0,0)),M>0&&(h=u.clone().sub(d).pow(2).sum()),d=u.clone(),t?(m=t.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),m=m.div(m.norm()),l=t.mmul(m).div(m.transpose().mmul(m).get(0,0))):l=u;if(t){let M=s.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0));M=M.div(M.norm());let p=s.clone().sub(u.clone().mmul(M.transpose())),g=l.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),P=t.clone().sub(u.clone().mulS(g.get(0,0)).mmul(m.transpose()));this.t=u,this.p=M.transpose(),this.w=a.transpose(),this.q=m,this.u=l,this.s=u.transpose().mmul(u),this.xResidual=p,this.yResidual=P,this.betas=g}else this.w=a.transpose(),this.s=u.transpose().mmul(u).sqrt(),i?this.t=u.clone().div(this.s.get(0,0)):this.t=u,this.xResidual=s.sub(u.mmul(a.transpose()))}}z.AbstractMatrix=X,z.CHO=ue,z.CholeskyDecomposition=ue,z.DistanceMatrix=qt,z.EVD=he,z.EigenvalueDecomposition=he,z.LU=Dt,z.LuDecomposition=Dt;var fe=z.Matrix=x;z.MatrixColumnSelectionView=Ae,z.MatrixColumnView=Qe,z.MatrixFlipColumnView=Ze,z.MatrixFlipRowView=He,z.MatrixRowSelectionView=ei,z.MatrixRowView=ti,z.MatrixSelectionView=Xt,z.MatrixSubView=ii,z.MatrixTransposeView=si,z.NIPALS=ae,z.Nipals=ae,z.QR=Kt,z.QrDecomposition=Kt,z.SVD=It,z.SingularValueDecomposition=It,z.SymmetricMatrix=Mt,z.WrapperMatrix1D=re,z.WrapperMatrix2D=ft,z.correlation=fi,z.covariance=ai;var ce=z.default=x;z.determinant=zt,z.inverse=ni,z.linearDependencies=hi,z.pseudoInverse=ui,z.solve=le,z.wrap=oi;const K=fe;ce.Matrix&&ce.Matrix;var me="4.1.0",pe=Math.pow;console.log(`Psychophysics Version ${me}`),typeof A.VERSION!="undefined"&&console.log(`PixiJS Version ${A.VERSION}`);const gi={name:"psychophysics",version:me,description:"A plugin for conducting online/Web-based psychophysical experiments",parameters:{stimuli:{type:_.ParameterType.COMPLEX,array:!0,pretty_name:"Stimuli",description:"The objects will be presented in the canvas.",nested:{startX:{type:_.ParameterType.STRING,pretty_name:"startX",default:"center",description:"The horizontal start position."},startY:{type:_.ParameterType.STRING,pretty_name:"startY",default:"center",description:"The vertical start position."},endX:{type:_.ParameterType.STRING,pretty_name:"endX",default:null,description:"The horizontal end position."},endY:{type:_.ParameterType.STRING,pretty_name:"endY",default:null,description:"The vertical end position."},show_start_time:{type:_.ParameterType.INT,pretty_name:"Show start time",default:0,description:"Time to start presenting the stimuli"},show_end_time:{type:_.ParameterType.INT,pretty_name:"Show end time",default:null,description:"Time to end presenting the stimuli"},show_start_frame:{type:_.ParameterType.INT,pretty_name:"Show start frame",default:0,description:"Time to start presenting the stimuli in frames"},show_end_frame:{type:_.ParameterType.INT,pretty_name:"Show end frame",default:null,description:"Time to end presenting the stimuli in frames"},line_width:{type:_.ParameterType.INT,pretty_name:"Line width",default:1,description:"The line width"},lineJoin:{type:_.ParameterType.STRING,pretty_name:"lineJoin",default:"miter",description:"The type of the corner when two lines meet."},miterLimit:{type:_.ParameterType.INT,pretty_name:"miterLimit",default:10,description:"The maximum miter length."},drawFunc:{type:_.ParameterType.FUNCTION,pretty_name:"Draw function",default:null,description:"This function enables to move objects horizontally and vertically."},change_attr:{type:_.ParameterType.FUNCTION,pretty_name:"Change attributes",default:null,description:"This function enables to change attributes of objects immediately before drawing."},is_frame:{type:_.ParameterType.BOOL,pretty_name:"time is in frames",default:!1,description:"If true, time is treated in frames."},prepared:{type:_.ParameterType.BOOL,pretty_name:"Stimulus prepared flag",default:!1,description:"If true, the stimulus is prepared for presentation"},origin_center:{type:_.ParameterType.BOOL,pretty_name:"origin_center",default:!1,description:"The origin is the center of the window."},is_presented:{type:_.ParameterType.BOOL,pretty_name:"is_presented",default:!1,description:"This will be true when the stimulus is presented."},trial_ends_after_audio:{type:_.ParameterType.BOOL,pretty_name:"Trial ends after audio",default:!1,description:"If true, then the trial will end as soon as the audio file finishes playing."},modulate_color:{type:_.ParameterType.FLOAT,array:!0,pretty_name:"modulate_color",default:[1,1,1,1],description:"The base RGBA array of the gabor patch."},offset_color:{type:_.ParameterType.FLOAT,array:!0,pretty_name:"offset_color",default:[.5,.5,.5,0],description:"The offset RGBA array of the gabor patch."},min_validModulationRange:{type:_.ParameterType.FLOAT,pretty_name:"min_validModulationRange",default:-2,description:"The minimum of the validation range of the gabor patch."},max_validModulationRange:{type:_.ParameterType.FLOAT,pretty_name:"max_validModulationRange",default:2,description:"The maximum of the validation range of the gabor patch."},tilt:{type:_.ParameterType.FLOAT,pretty_name:"tilt",default:0,description:"The angle of the gabor patch in degrees."},sf:{type:_.ParameterType.FLOAT,pretty_name:"spatial frequency",default:.05,description:"The spatial frequency of the gabor patch."},phase:{type:_.ParameterType.FLOAT,pretty_name:"phase",default:0,description:"The phase (degrees) of the gabor patch."},sc:{type:_.ParameterType.FLOAT,pretty_name:"standard deviation",default:20,description:"The standard deviation of the distribution."},contrast:{type:_.ParameterType.FLOAT,pretty_name:"contrast",default:20,description:"The contrast of the gabor patch."},contrastPreMultiplicator:{type:_.ParameterType.FLOAT,pretty_name:"contrastPreMultiplicator",default:1,description:"A scaling factor"},drift:{type:_.ParameterType.FLOAT,pretty_name:"drift",default:0,description:"The velocity of the drifting gabor patch."},method:{type:_.ParameterType.STRING,pretty_name:"gabor_drawing_method",default:"ml-matrix",description:"The method of drawing the gabor patch."},disableNorm:{type:_.ParameterType.BOOL,pretty_name:"disableNorm",default:!1,description:"Disable normalization of the gaussian function."},disableGauss:{type:_.ParameterType.BOOL,pretty_name:"disableGauss",default:!1,description:"Disable to convolve with a Gaussian."},mask_func:{type:_.ParameterType.FUNCTION,pretty_name:"Masking function",default:null,description:"Masking the image manually."},text_color:{type:_.ParameterType.STRING,pretty_name:"text color",default:"#000000",description:"The color of the text."},fontStyle:{type:_.ParameterType.STRING,pretty_name:"font style",default:"normal",description:"Font style"},fontWeight:{type:_.ParameterType.STRING,pretty_name:"font weight",default:"normal",description:"Font weight"},fontSize:{type:_.ParameterType.STRING,pretty_name:"font size",default:"20px",description:"Font size"},fontFamily:{type:_.ParameterType.STRING,pretty_name:"font family",default:"Verdana, Arial, Helvetica, sans-serif",description:"Font family"}}},pixi:{type:_.ParameterType.BOOL,pretty_name:"Enable Pixi",default:!1,description:"If true, this plugin will use PixiJS"},remain_canvas:{type:_.ParameterType.BOOL,pretty_name:"Remain canvas",default:!1,description:"If true, the main canvas remains for the next trial."},choices:{type:_.ParameterType.KEYS,pretty_name:"Choices",default:"ALL_KEYS",description:"The keys the subject is allowed to press to respond to the stimulus."},prompt:{type:_.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null,description:"Any content here will be displayed below the stimulus."},upper_prompt:{type:_.ParameterType.HTML_STRING,pretty_name:"Upper prompt",default:null,description:"Any content here will be displayed above the stimulus."},lower_prompt:{type:_.ParameterType.HTML_STRING,pretty_name:"Lower prompt",default:null,description:"This is the same as the prompt."},canvas_width:{type:_.ParameterType.INT,pretty_name:"Canvas width",default:null,description:"The width of the canvas."},canvas_height:{type:_.ParameterType.INT,pretty_name:"Canvas height",default:null,description:"The height of the canvas."},canvas_offsetX:{type:_.ParameterType.INT,pretty_name:"Canvas offset X",default:0,description:"This value is subtracted from the width of the canvas."},canvas_offsetY:{type:_.ParameterType.INT,pretty_name:"Canvas offset Y",default:8,description:"This value is subtracted from the height of the canvas."},trial_duration:{type:_.ParameterType.INT,pretty_name:"Trial duration",default:null,description:"How long to show trial before it ends."},response_ends_trial:{type:_.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0,description:"If true, trial will end when subject makes a response."},background_color:{type:_.ParameterType.STRING,pretty_name:"Background color",default:"grey",description:"The background color of the canvas."},response_type:{type:_.ParameterType.STRING,pretty_name:"key, mouse or button",default:"key",description:"How to make a response."},response_start_time:{type:_.ParameterType.INT,pretty_name:"Response start",default:0,description:"When the subject is allowed to respond to the stimulus."},raf_func:{type:_.ParameterType.FUNCTION,pretty_name:"Step function",default:null,description:"This function enables to move objects as you wish."},mouse_down_func:{type:_.ParameterType.FUNCTION,pretty_name:"Mouse down function",default:null,description:"This function is set to the event listener of the mousedown."},mouse_move_func:{type:_.ParameterType.FUNCTION,pretty_name:"Mouse move function",default:null,description:"This function is set to the event listener of the mousemove."},mouse_up_func:{type:_.ParameterType.FUNCTION,pretty_name:"Mouse up function",default:null,description:"This function is set to the event listener of the mouseup."},key_down_func:{type:_.ParameterType.FUNCTION,pretty_name:"Key down function",default:null,description:"This function is set to the event listener of the keydown."},key_up_func:{type:_.ParameterType.FUNCTION,pretty_name:"Key up function",default:null,description:"This function is set to the event listener of the keyup."},touchstart_func:{type:_.ParameterType.FUNCTION,pretty_name:"Touch start function",default:null,description:"This function is set to the event listener of the CANVAS touchstart."},touchend_func:{type:_.ParameterType.FUNCTION,pretty_name:"Touch end function",default:null,description:"This function is set to the event listener of the CANVAS touchend."},touchcancel_func:{type:_.ParameterType.FUNCTION,pretty_name:"Touch cancel function",default:null,description:"This function is set to the event listener of the CANVAS touchcancel."},touchmove_func:{type:_.ParameterType.FUNCTION,pretty_name:"Touch move function",default:null,description:"This function is set to the event listener of the CANVAS touchmove."},button_choices:{type:_.ParameterType.STRING,pretty_name:"Button choices",default:null,description:"The labels for the buttons."},button_html:{type:_.ParameterType.FUNCTION,default:function(n,s){return`<button class="jspsych-btn">${n}</button>`}},button_layout:{type:_.ParameterType.STRING,default:"grid"},grid_rows:{type:_.ParameterType.INT,default:1},grid_columns:{type:_.ParameterType.INT,default:null},vert_button_margin:{type:_.ParameterType.STRING,pretty_name:"Margin vertical",default:"0px",description:"The vertical margin of the button."},horiz_button_margin:{type:_.ParameterType.STRING,pretty_name:"Margin horizontal",default:"8px",description:"The horizontal margin of the button."},clear_canvas:{type:_.ParameterType.BOOL,pretty_name:"clear_canvas",default:!0,description:"Clear the canvas per frame."}},data:{rt:{type:_.ParameterType.INT},response_type:{type:_.ParameterType.STRING},key_press:{type:_.ParameterType.STRING},response:{type:_.ParameterType.STRING},avg_frame_time:{type:_.ParameterType.FLOAT},click_x:{type:_.ParameterType.FLOAT},click_y:{type:_.ParameterType.FLOAT},center_x:{type:_.ParameterType.FLOAT},center_y:{type:_.ParameterType.FLOAT},button_pressed:{type:_.ParameterType.INT},stimulus:{type:_.ParameterType.HTML_STRING}}};class de{constructor(s){this.jsPsych=s}trial(s,e){function t(N,b){return[...Array(b)].map((w,R)=>R+N)}const i=document.createElement("canvas");i.id="canvas_for_color",i.style.display="none";const o=i.getContext("2d");function r(N){o.fillStyle=N;const b=o.fillStyle,w=b[1]+b[2]+b[3]+b[4]+b[5]+b[6]+b[7]+b[8];return parseInt(w,16)}e.getColorNum=r;class l{constructor(b){Object.assign(this,b);const w=Object.keys(this);for(var R=0;R<w.length;R++)if(typeof this[w[R]]=="function"){if(w[R]==="drawFunc"||w[R]==="change_attr"||w[R]==="mask_func")continue;this[w[R]]=this[w[R]].call()}}}class h extends l{constructor(b){super(b),this.startX==="center"&&(this.origin_center?this.startX=0:this.startX=D),this.startY==="center"&&(this.origin_center?this.startY=0:this.startY=B),this.endX==="center"&&(this.origin_center?this.endX=0:this.endX=D),this.endY==="center"&&(this.origin_center?this.endY=0:this.endY=B),this.origin_center&&(this.startX=this.startX+D,this.startY=this.startY+B,this.endX!==null&&(this.endX=this.endX+D),this.endY!==null&&(this.endY=this.endY+B)),typeof this.motion_start_time=="undefined"&&(this.motion_start_time=this.show_start_time),typeof this.motion_end_time=="undefined"&&(this.motion_end_time=null),typeof this.motion_start_frame=="undefined"&&(this.motion_start_frame=this.show_start_frame),typeof this.motion_end_frame=="undefined"&&(this.motion_end_frame=null),e.clear_canvas===!1&&this.show_end_time!==null&&alert("You can not specify the show_end_time with the clear_canvas property."),this.horiz_pix_sec=this.calc_pix_per_sec("horiz"),this.vert_pix_sec=this.calc_pix_per_sec("vert"),this.currentX=this.startX,this.currentY=this.startY}calc_pix_per_sec(b){let w,R,L,j;b==="horiz"?(w=this.horiz_pix_sec,R=this.horiz_pix_frame,L=this.startX,j=this.endX):(w=this.vert_pix_sec,R=this.vert_pix_frame,L=this.startY,j=this.endY);const G=this.motion_start_time,U=this.motion_end_time;return(typeof w!="undefined"||typeof R!="undefined")&&j!==null&&U!==null&&(alert("You can not specify the speed, location, and time at the same time."),w=0),typeof w!="undefined"||typeof R!="undefined"?w:j===null||L===j?0:U===null?(alert("Please specify the motion_end_time or the velocity when you use the endX/Y property."),0):(j-L)/(U/1e3-G/1e3)}calc_current_position(b,w){let R,L,j,G,U;b==="horiz"?(R=this.horiz_pix_frame,L=this.horiz_pix_sec,j=this.currentX,G=this.startX,U=this.endX):(R=this.vert_pix_frame,L=this.vert_pix_sec,j=this.currentY,G=this.startY,U=this.endY);const mt=this.is_frame?this.motion_start_frame:this.motion_start_time,rt=this.is_frame?this.motion_end_frame:this.motion_end_time;if(w<mt||rt!==null&&w>=rt)return j;let pt=!0;return typeof R=="undefined"?L<0&&(pt=!1):R<0&&(pt=!1),U===null||pt&&j<=U||!pt&&j>=U?typeof R=="undefined"?G+Math.round(L*(w-mt)/1e3):j+R:j}update_position(b){this.currentX=this.calc_current_position("horiz",b),this.currentY=this.calc_current_position("vert",b)}}class u extends h{constructor(b){if(super(b),typeof this.file=="undefined"){alert("You have to specify the file property.");return}this.img=new Image,this.img.src=this.file,this.img.onload=()=>{const w=e.pixi?1:window.devicePixelRatio;if(typeof this.mask=="undefined"&&typeof this.filter=="undefined"){e.pixi&&(this.pixi_obj=A.Sprite.from(this.file),typeof this.pixi_mask!="undefined"&&(this.pixi_obj.mask=this.pixi_mask),typeof this.pixi_filters!="undefined"&&(this.pixi_obj.filters=this.pixi_filters),T(this.pixi_obj)),this.prepared=!0;return}if(document.getElementById("invisible_canvas")===null){const j=document.createElement("canvas");j.id="invisible_canvas",s.appendChild(j),j.style.display="none"}const R=document.getElementById("invisible_canvas"),L=H(R,w,this.img.width,this.img.height).ctx;if(L.clearRect(0,0,R.width,R.height),typeof this.filter=="undefined"?L.filter="none":L.filter=this.filter,L.drawImage(this.img,0,0,this.img.width,this.img.height),typeof this.mask=="undefined"){const j=L.getImageData(0,0,this.img.width*w,this.img.height*w);if(e.pixi){const G=A.Texture.fromBuffer(j.data,j.width,j.height);this.pixi_obj=new A.Sprite(G),T(this.pixi_obj)}else this.masking_img=j;this.prepared=!0;return}if(this.mask==="manual"){if(this.mask_func===null){alert("You have to specify the mask_func when applying masking manually.");return}const j=this.mask_func(R);if(e.pixi){const G=A.Texture.fromBuffer(j.data,j.width,j.height);this.pixi_obj=new A.Sprite(G),T(this.pixi_obj)}else this.masking_img=j;this.prepared=!0;return}if(this.mask==="gauss"){if(typeof this.width=="undefined"){alert("You have to specify the width property for the gaussian mask. For example, 200.");return}const j=this.width*w,G=L.getImageData(this.img.width*w/2-j/2,this.img.height*w/2-j/2,j,j);let U=t(Math.round(0-j/2),j),mt=[];for(let Q=0;Q<j;Q++)mt.push(U);U=t(Math.round(0-j/2),j);let rt=[];for(let Q=0;Q<j;Q++)rt.push(U);let pt;const xt=this.sc*w;if(this.method==="math"?alert("The math method is not supported. Please use the ml-matrix method instead."):this.method==="numeric"&&alert("The numeric method is not supported. Please use the ml-matrix method instead."),this.method==="ml-matrix"){const Q=new K(mt),ot=new K(rt).transpose(),ht=K.pow(Q,2).mul(-1),bt=K.pow(ot,2).mul(-1),Gt=2*Math.pow(xt,2);pt=K.add(K.divide(ht,Gt),K.divide(bt,Gt)).exp().to2DArray()}let yt=3;for(let Q=0;Q<j;Q++)for(let ot=0;ot<j;ot++)G.data[yt]=pt[Q][ot]*255,yt=yt+4;if(e.pixi){const Q=A.Texture.fromBuffer(G.data,G.width,G.height);this.pixi_obj=new A.Sprite(Q),T(this.pixi_obj)}else this.masking_img=G;this.prepared=!0;return}if(this.mask==="circle"||this.mask==="rect"){if(typeof this.width=="undefined"){alert("You have to specify the width property for the circle/rect mask.");return}if(typeof this.height=="undefined"){alert("You have to specify the height property for the circle/rect mask.");return}if(typeof this.center_x=="undefined"){alert("You have to specify the center_x property for the circle/rect mask.");return}if(typeof this.center_y=="undefined"){alert("You have to specify the center_y property for the circle/rect mask.");return}const j=this.width*w,G=this.height*w,U=this.center_x*w,mt=this.center_y*w,rt=L.getImageData(U-j/2,mt-G/2,j,G),pt=rt.width/2,xt=rt.height/2;if(this.mask==="circle"){let yt=3;for(let Q=0;Q<G;Q++)for(let ot=0;ot<j;ot++)Math.pow(ot-pt,2)/Math.pow(pt,2)+Math.pow(Q-xt,2)/Math.pow(xt,2)>1&&(rt.data[yt]=0),yt=yt+4}if(e.pixi){const yt=A.Texture.fromBuffer(rt.data,rt.width,rt.height);this.pixi_obj=new A.Sprite(yt),T(this.pixi_obj)}else this.masking_img=rt;this.prepared=!0;return}}}show(){if(e.pixi){typeof this.scale!="undefined"&&typeof this.image_width!="undefined"&&alert("You can not specify the scale and image_width at the same time."),typeof this.scale!="undefined"&&typeof this.image_height!="undefined"&&alert("You can not specify the scale and image_height at the same time."),typeof this.image_height!="undefined"&&typeof this.image_width!="undefined"&&alert("You can not specify the image_height and image_width at the same time.");let b=1;typeof this.scale!="undefined"&&(b=this.scale),typeof this.image_width!="undefined"&&(b=this.image_width/this.img.width),typeof this.image_height!="undefined"&&(b=this.image_height/this.img.height),this.pixi_obj.scale.x=b,this.pixi_obj.scale.y=b,typeof this.pixi_angle!="undefined"&&(this.pixi_obj.angle=this.pixi_angle),typeof this.pixi_rotation!="undefined"&&(this.pixi_obj.rotation=this.pixi_rotation),this.pixi_obj.x=this.currentX,this.pixi_obj.y=this.currentY,this.pixi_obj.visible=!0}else if(this.mask||this.filter)S.putImageData(this.masking_img,this.currentX*window.devicePixelRatio-this.masking_img.width/2,this.currentY*window.devicePixelRatio-this.masking_img.height/2);else{typeof this.scale!="undefined"&&typeof this.image_width!="undefined"&&alert("You can not specify the scale and image_width at the same time."),typeof this.scale!="undefined"&&typeof this.image_height!="undefined"&&alert("You can not specify the scale and image_height at the same time."),typeof this.image_height!="undefined"&&typeof this.image_width!="undefined"&&alert("You can not specify the image_height and image_width at the same time.");let b=1;typeof this.scale!="undefined"&&(b=this.scale),typeof this.image_width!="undefined"&&(b=this.image_width/this.img.width),typeof this.image_height!="undefined"&&(b=this.image_height/this.img.height);const w=this.img.width*b,R=this.img.height*b;S.drawImage(this.img,0,0,this.img.width,this.img.height,this.currentX-w/2,this.currentY-R/2,w,R)}}}class m extends h{constructor(b){if(super(b),!e.pixi){this.update_count=0,this.prepared=!0;return}const w=`
            precision mediump float;

            uniform float Contrast;
            uniform float Phase;
            uniform float angle_in_degrees; // tilt
            uniform float spatial_freq;
            uniform float SpaceConstant;
            uniform float disableNorm;
            uniform float disableGauss;
            uniform float modulateColor_R;
            uniform float modulateColor_G;
            uniform float modulateColor_B;
            uniform float modulateColor_Alpha;
            uniform float offset_R;
            uniform float offset_G;
            uniform float offset_B;
            uniform float offset_Alpha;
            uniform float centerX;
            uniform float centerY;
            uniform float contrastPreMultiplicator;
            uniform float min_validModulationRange;
            uniform float max_validModulationRange;

            void main() {
                const float twopi     = 2.0 * 3.141592654;
                const float sqrtof2pi = 2.5066282746;
                /* Conversion factor from degrees to radians: */
                const float deg2rad = 3.141592654 / 180.0;
                
                float Angle = deg2rad * angle_in_degrees;
                float FreqTwoPi = spatial_freq * twopi;
                float Expmultiplier = -0.5 / (SpaceConstant * SpaceConstant);
                float mc = disableNorm + (1.0 - disableNorm) * (1.0 / (sqrtof2pi * SpaceConstant));

                vec3 modulateColor = vec3(modulateColor_R, modulateColor_G, modulateColor_B);

                vec3 baseColor = modulateColor * mc * Contrast * contrastPreMultiplicator;

                vec2 pos = gl_FragCoord.xy - vec2(centerX, centerY);

                /* Compute (x,y) distance weighting coefficients, based on rotation angle: */
                vec2 coeff = vec2(cos(Angle), sin(Angle)) * FreqTwoPi;

                /* Evaluate sine grating at requested position, angle and phase: */
                float sv = sin(dot(coeff, pos) + Phase);

                /* Compute exponential hull for the gabor: */
                float ev = disableGauss + (1.0 - disableGauss) * exp(dot(pos, pos) * Expmultiplier);

                /* Multiply/Modulate base color and alpha with calculated sine/gauss      */
                /* values, add some constant color/alpha Offset, assign as final fragment */
                /* output color: */

                vec4  Offset = vec4(offset_R, offset_G, offset_B, offset_Alpha);
                        
                // Be careful not to change the transparency. Note that the type of the baseColor valuable is vec3 not vec4.
                gl_FragColor = vec4(baseColor * clamp(ev * sv, min_validModulationRange, max_validModulationRange), modulateColor_Alpha) + Offset;

          }`,R=this.width,L=document.createElement("img");L.width=R,L.height=R;const j=A.Sprite.from(L);j.visible=!1,j.anchor.set(.5),j.x=E.screen.width/2,j.y=E.screen.height/2;const G={Contrast:this.contrast,Phase:this.phase,angle_in_degrees:90+this.tilt,spatial_freq:this.sf,SpaceConstant:this.sc,disableNorm:this.disableNorm?1:0,disableGauss:this.disableGauss?1:0,modulateColor_R:this.modulate_color[0],modulateColor_G:this.modulate_color[1],modulateColor_B:this.modulate_color[2],modulateColor_Alpha:this.modulate_color[3],offset_R:this.offset_color[0],offset_G:this.offset_color[1],offset_B:this.offset_color[2],offset_Alpha:this.offset_color[3],centerX:E.screen.width/2,centerY:E.screen.height/2,contrastPreMultiplicator:this.contrastPreMultiplicator,min_validModulationRange:-2,max_validModulationRange:2},U=new A.Filter(null,w,G);E.stage.addChild(j),j.filters=[U],this.pixi_obj=j,this.prepared=!0}show(){e.pixi?(this.pixi_obj.filters[0].uniforms.Phase+=this.drift,this.pixi_obj.x=this.currentX,this.pixi_obj.y=this.currentY,this.pixi_obj.filters[0].uniforms.centerX=this.currentX,this.pixi_obj.filters[0].uniforms.centerY=E.screen.height-this.currentY,this.pixi_obj.visible=!0):S.putImageData(this.img_data,this.currentX*window.devicePixelRatio-this.img_data.width/2,this.currentY*window.devicePixelRatio-this.img_data.height/2)}update_position(b){if(this.currentX=this.calc_current_position("horiz",b),this.currentY=this.calc_current_position("vert",b),e.pixi||typeof this.img_data!="undefined"&&this.drift===0)return;let w;const R=this.width*window.devicePixelRatio;let L=t(Math.round(0-R/2),R),j=[];for(let ht=0;ht<R;ht++)j.push(L);L=t(Math.round(0-R/2),R);let G=[];for(let ht=0;ht<R;ht++)G.push(L);const U=J(90-this.tilt),mt=Math.cos(U)*this.sf/window.devicePixelRatio*(2*Math.PI),rt=Math.sin(U)*this.sf/window.devicePixelRatio*(2*Math.PI),pt=this.sc*window.devicePixelRatio;let xt=1/(Math.sqrt(2*Math.PI)*pt);this.disableNorm&&(xt=1);const yt=J(this.phase+this.drift*this.update_count);if(this.update_count+=1,this.method==="math"?alert("The math method is not supported. Please use the ml-matrix method instead."):this.method==="numeric"&&alert("The numeric method is not supported. Please use the ml-matrix method instead."),this.method==="ml-matrix"){const ht=new K(j),bt=new K(G).transpose(),Gt=K.pow(ht,2).mul(-1),wi=K.pow(bt,2).mul(-1),yi=K.add(K.multiply(ht,mt),K.multiply(bt,rt)).add(yt).sin(),ge=2*Math.pow(pt,2),_i=this.disableGauss?1:K.add(K.divide(Gt,ge),K.divide(wi,ge)).exp(),bi=K.multiply(yi,_i),vi=K.multiply(bi,xt),Ti=K.multiply(K.multiply(vi,this.contrastPreMultiplicator),this.contrast);w=K.multiply(K.add(Ti,.5),256).to2DArray()}const Q=S.createImageData(R,R);let ot=0;for(let ht=0;ht<R;ht++)for(let bt=0;bt<R;bt++)Q.data[ot]=Math.round(w[ht][bt]),ot++,Q.data[ot]=Math.round(w[ht][bt]),ot++,Q.data[ot]=Math.round(w[ht][bt]),ot++,Q.data[ot]=255,ot++;this.img_data=Q}}class a extends h{constructor(b){if(super(b),typeof this.angle=="undefined"){if(typeof this.x1=="undefined"||typeof this.x2=="undefined"||typeof this.y1=="undefined"||typeof this.y2=="undefined"){alert("You have to specify the angle of lines, or the start (x1, y1) and end (x2, y2) coordinates.");return}this.startX=(this.x1+this.x2)/2,this.startY=(this.y1+this.y2)/2,this.origin_center&&(this.startX=this.startX+D,this.startY=this.startY+B),this.currentX=this.startX,this.currentY=this.startY,this.angle=Math.atan((this.y2-this.y1)/(this.x2-this.x1))*(180/Math.PI),this.line_length=Math.sqrt(pe(this.x2-this.x1,2)+pe(this.y2-this.y1,2))}else(typeof this.x1!="undefined"||typeof this.x2!="undefined"||typeof this.y1!="undefined"||typeof this.y2!="undefined")&&alert("You can not specify the angle and positions of the line at the same time."),typeof this.line_length=="undefined"&&alert("You have to specify the line_length property.");if(typeof this.line_color=="undefined"&&(this.line_color="black"),e.pixi){this.pixi_obj=new A.Graphics,this.pixi_obj.lineStyle({width:this.line_width,color:r(this.line_color),join:this.lineJoin,miterLimit:this.miterLimit});const w=J(this.angle),R=-this.line_length/2*Math.cos(w),L=-this.line_length/2*Math.sin(w),j=this.line_length/2*Math.cos(w),G=this.line_length/2*Math.sin(w);this.pixi_obj.moveTo(R,L),this.pixi_obj.lineTo(j,G),this.pixi_obj.visible=!1,E.stage.addChild(this.pixi_obj)}this.prepared=!0}show(){if(e.pixi)this.pixi_obj.x=this.currentX,this.pixi_obj.y=this.currentY,this.pixi_obj.visible=!0;else{typeof this.filter=="undefined"?S.filter="none":S.filter=this.filter,S.beginPath(),S.lineWidth=this.line_width,S.lineJoin=this.lineJoin,S.miterLimit=this.miterLimit;const b=J(this.angle),w=this.currentX-this.line_length/2*Math.cos(b),R=this.currentY-this.line_length/2*Math.sin(b),L=this.currentX+this.line_length/2*Math.cos(b),j=this.currentY+this.line_length/2*Math.sin(b);S.strokeStyle=this.line_color,S.moveTo(w,R),S.lineTo(L,j),S.stroke()}}}class d extends h{constructor(b){super(b),typeof this.width=="undefined"&&alert("You have to specify the width of the rectangle."),typeof this.height=="undefined"&&alert("You have to specify the height of the rectangle."),typeof this.line_color=="undefined"&&typeof this.fill_color=="undefined"&&alert("You have to specify the either of the line_color or fill_color property."),e.pixi&&(this.pixi_obj=new A.Graphics,this.pixi_obj.lineStyle({width:this.line_width,color:r(this.line_color),join:this.lineJoin,miterLimit:this.miterLimit}),typeof this.fill_color!="undefined"&&this.pixi_obj.beginFill(r(this.fill_color),1),this.pixi_obj.drawRect(-this.width/2,-this.height/2,this.width,this.height),typeof this.fill_color!="undefined"&&this.pixi_obj.endFill(),this.pixi_obj.visible=!1,E.stage.addChild(this.pixi_obj)),this.prepared=!0}show(){e.pixi?(this.pixi_obj.x=this.currentX,this.pixi_obj.y=this.currentY,this.pixi_obj.visible=!0):(typeof this.filter=="undefined"?S.filter="none":S.filter=this.filter,S.lineWidth=this.line_width,S.lineJoin=this.lineJoin,S.miterLimit=this.miterLimit,typeof this.fill_color!="undefined"&&(S.fillStyle=this.fill_color,S.fillRect(this.currentX-this.width/2,this.currentY-this.height/2,this.width,this.height)),typeof this.line_color!="undefined"&&(S.strokeStyle=this.line_color,S.strokeRect(this.currentX-this.width/2,this.currentY-this.height/2,this.width,this.height)))}}class M extends h{constructor(b){if(super(b),typeof this.line_length=="undefined"&&alert("You have to specify the line_length of the fixation cross."),typeof this.line_color=="undefined"&&(this.line_color="#000000"),e.pixi){this.pixi_obj=new A.Graphics,this.pixi_obj.lineStyle({width:this.line_width,color:r(this.line_color),join:this.lineJoin,miterLimit:this.miterLimit});const w=-this.line_length/2,R=0,L=this.line_length/2;this.pixi_obj.moveTo(w,R),this.pixi_obj.lineTo(L,0);const G=0,U=-this.line_length/2,mt=0,rt=this.line_length/2;this.pixi_obj.moveTo(G,U),this.pixi_obj.lineTo(mt,rt),this.pixi_obj.visible=!1,E.stage.addChild(this.pixi_obj)}this.prepared=!0}show(){if(e.pixi)this.pixi_obj.x=this.currentX,this.pixi_obj.y=this.currentY,this.pixi_obj.visible=!0;else{typeof this.filter=="undefined"?S.filter="none":S.filter=this.filter,S.beginPath(),S.lineWidth=this.line_width,S.lineJoin=this.lineJoin,S.miterLimit=this.miterLimit,S.strokeStyle=this.line_color;const b=this.currentX,w=this.currentY-this.line_length/2,R=this.currentX,L=this.currentY+this.line_length/2;S.moveTo(b,w),S.lineTo(R,L);const j=this.currentX-this.line_length/2,G=this.currentY,U=this.currentX+this.line_length/2,mt=this.currentY;S.moveTo(j,G),S.lineTo(U,mt),S.stroke()}}}class p extends h{constructor(b){if(super(b),typeof this.radius=="undefined"&&alert("You have to specify the radius of circles."),typeof this.line_color=="undefined"&&typeof this.fill_color=="undefined"&&alert("You have to specify the either of line_color or fill_color."),!e.pixi){this.prepared=!0;return}this.pixi_obj=new A.Graphics,this.pixi_obj.lineStyle({width:this.line_width,color:r(this.line_color),join:this.lineJoin,miterLimit:this.miterLimit}),typeof this.fill_color!="undefined"&&this.pixi_obj.beginFill(r(this.fill_color),1),this.pixi_obj.drawCircle(0,0,this.radius),typeof this.fill_color!="undefined"&&this.pixi_obj.endFill(),this.pixi_obj.visible=!1,E.stage.addChild(this.pixi_obj),this.prepared=!0}show(){e.pixi?(this.pixi_obj.x=this.currentX,this.pixi_obj.y=this.currentY,this.pixi_obj.visible=!0):(typeof this.filter=="undefined"?S.filter="none":S.filter=this.filter,S.beginPath(),S.lineWidth=this.line_width,S.lineJoin=this.lineJoin,S.miterLimit=this.miterLimit,typeof this.fill_color!="undefined"&&(S.fillStyle=this.fill_color,S.arc(this.currentX,this.currentY,this.radius,0,Math.PI*2,!1),S.fill()),typeof this.line_color!="undefined"&&(S.strokeStyle=this.line_color,S.arc(this.currentX,this.currentY,this.radius,0,Math.PI*2,!1),S.stroke()))}}class g extends h{constructor(b){if(super(b),typeof this.content=="undefined"&&alert("You have to specify the content of texts."),e.pixi)typeof this.text_space!="undefined"&&alert("You can't specify the text_space in Pixi mode."),this.pixi_obj=new A.Text(this.content),T(this.pixi_obj),this.pixi_obj.style.align="center",this.pixi_obj.style.fontFamily=this.fontFamily,this.pixi_obj.style.fontSize=this.fontSize,this.pixi_obj.style.fontStyle=this.fontStyle,this.pixi_obj.style.fontWeight=this.fontWeight,this.pixi_obj.style.fill=this.text_color,this.pixi_obj.style.lineJoin=this.lineJoin,this.pixi_obj.style.miterLimit=this.miterLimit,typeof this.pixi_angle!="undefined"&&(this.pixi_obj.angle=this.pixi_angle),typeof this.pixi_rotation!="undefined"&&(this.pixi_obj.rotation=this.pixi_rotation);else{typeof this.text_space=="undefined"&&(this.text_space=20);let w="";w=w+" "+this.fontStyle,w=w+" "+this.fontWeight,w=w+" "+this.fontSize,w=w+" "+this.fontFamily,typeof this.font=="undefined"&&(this.font=w)}this.prepared=!0}show(){if(e.pixi)this.pixi_obj.x=this.currentX,this.pixi_obj.y=this.currentY,this.pixi_obj.visible=!0;else{typeof this.filter=="undefined"?S.filter="none":S.filter=this.filter,S.lineWidth=this.line_width,S.lineJoin=this.lineJoin,S.miterLimit=this.miterLimit,S.font=this.font,S.textAlign="center",S.textBaseline="middle";let b=[""],w=0;for(let L=0;L<this.content.length;L++){let j=this.content.charAt(L);j==`
`?(w++,b[w]=""):b[w]+=j}let R=typeof this.stroke_color!="undefined"||typeof this.stroke_weight!="undefined"&&this.stroke_weight>0;for(let L=0;L<b.length;L++)S.fillStyle=this.text_color,S.fillText(b[L],this.currentX,this.currentY-this.text_space*(b.length-1)/2+this.text_space*L),R&&(S.strokeStyle=this.stroke_color,S.lineWidth=this.stroke_width,S.strokeText(b[L],this.currentX,this.currentY-this.text_space*(b.length-1)/2+this.text_space*L))}}}class P extends h{constructor(b){super(b),this.prepared=!0}show(){}}class f extends h{constructor(b){if(super(b),!e.pixi){alert("To use Pixi objects, the pixi property of the psychophysics plugin must be set to true.");return}this.pixi_obj.visible=!1,E.stage.addChild(this.pixi_obj),this.prepared=!0}show(){this.pixi_obj.x=this.currentX,this.pixi_obj.y=this.currentY,this.pixi_obj.visible=!0}}function T(N){N.anchor.set(.5),N.visible=!1,E.stage.addChild(N)}const I=this.jsPsych;class Y extends l{constructor(b){if(super(b),typeof this.file=="undefined"){alert("You have to specify the file property.");return}I.pluginAPI.getAudioPlayer(this.file).then(w=>{this.audio=w,this.prepared=!0}).catch(w=>{console.error(`Failed to load audio file "${this.file}". Try checking the file path. We recommend using the preload plugin to load audio files.`),console.error(w)}),this.trial_ends_after_audio&&this.audio.addEventListener("ended",jt)}play(){this.audio.play()}stop(){this.audio.stop(),this.audio.removeEventListener("ended",jt)}}typeof e.stepFunc!="undefined"&&alert("The stepFunc is no longer supported. Please use the raf_func instead.");const F=document.getElementById("jspsych-content"),V=window.getComputedStyle(F).maxWidth;F.style.maxWidth="none",e.canvas_width===null&&(e.canvas_width=window.innerWidth-e.canvas_offsetX),e.canvas_height===null&&(e.canvas_height=window.innerHeight-e.canvas_offsetY);let E,C="";const $=document.getElementById("myCanvas")!==null;!$&&e.upper_prompt!==null&&(C+=e.upper_prompt),$||(e.pixi?(E=new A.Application({width:e.canvas_width,height:e.canvas_height,backgroundColor:r(e.background_color)}),s.appendChild(E.view)):C+='<canvas id="myCanvas" class="jspsych-canvas" width='+e.canvas_width+" height="+e.canvas_height+' style="background-color:'+e.background_color+';"></canvas>');const c="performance";let y,k,v=!1;if(this.jsPsych.pluginAPI.setTimeout(()=>{v=!0,e.response_type==="key"?e.choices!="NO_KEYS"&&(k=this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:Lt,valid_responses:e.choices,rt_method:c,persist:!1,allow_held_key:!1})):e.response_type==="mouse"?(y=performance.now(),O.addEventListener("mousedown",Z)):y=performance.now()},e.response_start_time),!$&&e.prompt!==null&&(C+=e.prompt),!$&&e.lower_prompt!==null&&(C+=e.lower_prompt),s.insertAdjacentHTML("beforeend",C),!$&&e.response_type==="button"){const N=document.createElement("div");if(N.id="jspsych-html-button-response-btngroup",e.button_layout==="grid"){if(N.classList.add("jspsych-btn-group-grid"),e.grid_rows===null&&e.grid_columns===null)throw new Error("You cannot set `grid_rows` to `null` without providing a value for `grid_columns`.");const b=e.grid_columns===null?Math.ceil(e.button_choices.length/e.grid_rows):e.grid_columns,w=e.grid_rows===null?Math.ceil(e.button_choices.length/e.grid_columns):e.grid_rows;N.style.gridTemplateColumns=`repeat(${b}, 1fr)`,N.style.gridTemplateRows=`repeat(${w}, 1fr)`}else e.button_layout==="flex"&&N.classList.add("jspsych-btn-group-flex");for(const[b,w]of e.button_choices.entries()){N.insertAdjacentHTML("beforeend",e.button_html(w,b));const R=N.lastChild;R.dataset.choice=b.toString(),R.addEventListener("click",()=>{Lt({key:-1,rt:performance.now()-y,button:b})})}s.appendChild(N)}const O=e.pixi===!0?E.view:document.getElementById("myCanvas");if(!O||!O.getContext){alert("This browser does not support the canvas element.");return}let D,B,S;function H(N,b,w,R){const L=N.getContext("2d"),j=b;N.style.width=w+"px",N.style.height=R+"px",$||(N.width=w*j,N.height=R*j,L.scale(j,j));const G=N.width/2/j,U=N.height/2/j;return{ctx:L,centerX:G,centerY:U}}if(e.pixi)D=E.screen.width/2,B=E.screen.height/2;else{const N=H(O,window.devicePixelRatio,e.canvas_width,e.canvas_height);D=N.centerX,B=N.centerY,S=N.ctx,e.context=S}if(e.canvas=O,e.centerX=D,e.centerY=B,e.mouse_down_func!==null&&O.addEventListener("mousedown",e.mouse_down_func),e.mouse_move_func!==null&&O.addEventListener("mousemove",e.mouse_move_func),e.mouse_up_func!==null&&O.addEventListener("mouseup",e.mouse_up_func),e.key_down_func!==null&&document.addEventListener("keydown",e.key_down_func),e.key_up_func!==null&&document.addEventListener("keyup",e.key_up_func),e.touchstart_func!==null&&O.addEventListener("touchstart",e.touchstart_func),e.touchend_func!==null&&O.addEventListener("touchend",e.touchend_func),e.touchcancel_func!==null&&O.addEventListener("touchcancel",e.touchcancel_func),e.touchmove_func!==null&&O.addEventListener("touchmove",e.touchmove_func),typeof e.stimuli=="undefined"&&e.raf_func===null){alert("You have to specify the stimuli/raf_func parameter in the psychophysics plugin.");return}const ct={sound:Y,image:u,line:a,rect:d,circle:p,text:g,cross:M,manual:P,gabor:m,pixi:f};if(typeof e.stimuli!="undefined")for(let N=0;N<e.stimuli.length;N++){const b=e.stimuli[N];if(typeof b.obj_type=="undefined"){alert("You have missed to specify the obj_type property in the "+(N+1)+"th object.");return}b.instance=new ct[b.obj_type](b)}function Z(N){let b;b=performance.now(),N.preventDefault(),Lt({key:-1,rt:b-y,clickX:N.offsetX,clickY:N.offsetY})}let at=null,nt,q,tt=!0;function it(N){if(tt){for(let b=0;b<e.stimuli.length;b++)if(!e.stimuli[b].instance.prepared){st=window.requestAnimationFrame(it);return}}if(tt=!1,at?nt+=1:(at=N,nt=0),q=N-at,e.clear_canvas&&!e.pixi&&S.clearRect(0,0,O.width,O.height),e.raf_func!==null){e.raf_func(e,q,nt),st=window.requestAnimationFrame(it);return}for(let b=0;b<e.stimuli.length;b++){const w=e.stimuli[b].instance,R=w.is_frame?nt:q,L=w.is_frame?w.show_start_frame:w.show_start_time,j=w.is_frame?w.show_end_frame:w.show_end_time;if(w.obj_type==="sound"){R>=L&&!w.is_presented&&(w.play(),w.is_presented=!0);continue}if(e.pixi){if(R<L){w.pixi_obj.visible=!1;continue}if(j!==null&&R>=j){w.pixi_obj.visible=!1;continue}}else if(R<L||j!==null&&R>=j||e.clear_canvas===!1&&w.is_presented)continue;w.update_position(R),w.drawFunc!==null?w.drawFunc(w,O,S,q,nt):(w.change_attr!=null&&w.change_attr(w,q,nt),w.show()),w.is_presented=!0}st=window.requestAnimationFrame(it)}let st=window.requestAnimationFrame(it);function J(N){return N/180*Math.PI}let wt={rt:null,key:null};const jt=()=>{if(document.getElementById("jspsych-content").style.maxWidth=V,window.cancelAnimationFrame(st),O.removeEventListener("mousedown",Z),e.mouse_down_func!==null&&O.removeEventListener("mousedown",e.mouse_down_func),e.mouse_move_func!==null&&O.removeEventListener("mousemove",e.mouse_move_func),e.mouse_up_func!==null&&O.removeEventListener("mouseup",e.mouse_up_func),e.touchstart_func!==null&&O.removeEventListener("touchstart",e.touchstart_func),e.touchend_func!==null&&O.removeEventListener("touchend",e.touchend_func),e.touchcancel_func!==null&&O.removeEventListener("touchcancel",e.touchcancel_func),e.touchmove_func!==null&&O.removeEventListener("touchmove",e.touchmove_func),e.key_down_func!==null&&document.removeEventListener("keydown",e.key_down_func),e.key_up_func!==null&&document.removeEventListener("keyup",e.key_up_func),typeof e.stimuli!="undefined")for(let b=0;b<e.stimuli.length;b++){const w=e.stimuli[b].instance;typeof w.pixi_obj!="undefined"&&w.pixi_obj.destroy(),w.obj_type==="sound"&&w.stop()}!e.remain_canvas&&e.pixi&&E.destroy(!0,{children:!0,texture:!0,baseTexture:!0}),this.jsPsych.pluginAPI.clearAllTimeouts(),typeof k!="undefined"&&this.jsPsych.pluginAPI.cancelKeyboardResponse(k),this.jsPsych.pluginAPI.cancelAllKeyboardResponses();const N={};N.rt=wt.rt,N.response_type=e.response_type,N.key_press=wt.key,N.response=wt.key,N.avg_frame_time=q/nt,N.center_x=D,N.center_y=B,e.response_type==="mouse"?(N.click_x=wt.clickX,N.click_y=wt.clickY):e.response_type==="button"&&(N.button_pressed=wt.button,N.response=wt.button),e.remain_canvas||(s.innerHTML=""),this.jsPsych.finishTrial(N)};e.end_trial=jt;function Lt(N){if(v){if(wt.key==null&&(wt=N),e.response_type==="button"){let b=document.querySelectorAll(".jspsych-image-button-response-button button");for(let w=0;w<b.length;w++)b[w].setAttribute("disabled","disabled")}e.response_ends_trial&&jt()}}e.trial_duration!==null&&this.jsPsych.pluginAPI.setTimeout(function(){jt()},e.trial_duration)}simulate(s,e,t,i){e=="data-only"&&(i(),this.simulate_data_only(s,t)),e=="visual"&&this.simulate_visual(s,t,i)}create_simulation_data(s,e){let t=-1;s.response_type==="key"&&(t=this.jsPsych.pluginAPI.getValidKey(s.choices)),s.response_type==="button"&&(t=this.jsPsych.randomization.randomInt(0,s.button_choices.length-1));const i={stimulus:s.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),response:t},o=this.jsPsych.pluginAPI.mergeSimulationData(i,e);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(s,o),o}simulate_data_only(s,e){const t=this.create_simulation_data(s,e);this.jsPsych.finishTrial(t)}simulate_visual(s,e,t){const i=this.create_simulation_data(s,e),o=this.jsPsych.getDisplayElement();if(this.trial(o,s),t(),i.rt!==null)switch(s.response_type){case"key":this.jsPsych.pluginAPI.pressKey(i.response,i.rt);break;case"button":this.jsPsych.pluginAPI.clickTarget(o.querySelector(`#jspsych-html-button-response-btngroup [data-choice="${i.response}"]`),i.rt);break;case"mouse":{const r=document.getElementById("myCanvas").getBoundingClientRect();typeof i.click_x=="undefined"&&(i.click_x=0),typeof i.click_y=="undefined"&&(i.click_y=0);const l=new MouseEvent("mousedown",{bubbles:!0,clientX:i.click_x+r.left,clientY:i.click_y+r.top});setTimeout(()=>{document.getElementById("myCanvas").dispatchEvent(l)},i.rt);break}}}}return de.info=gi,de}(jsPsychModule,PIXI);
//# sourceMappingURL=index.browser.min.js.map
